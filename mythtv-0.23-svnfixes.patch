diff -Naurp mythtv-0.23-release/bindings/perl/IO/Socket/INET/MythTV.pm mythtv-0.23/bindings/perl/IO/Socket/INET/MythTV.pm
--- mythtv-0.23-release/bindings/perl/IO/Socket/INET/MythTV.pm	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/bindings/perl/IO/Socket/INET/MythTV.pm	2009-04-10 20:04:30.069718000 -0400
@@ -3,8 +3,8 @@
 # A MythTV Socket class that extends IO::Socket::INET to include some
 # MythTV-specific data queries
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/bindings/perl/IO/Socket/INET/MythTV.pm $
-# @date      $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/bindings/perl/IO/Socket/INET/MythTV.pm $
+# @date      $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 # @version   $Revision: 20349 $
 # @author    $Author: xris $
 # @copyright Silicon Mechanics
diff -Naurp mythtv-0.23-release/bindings/perl/MythTV/Channel.pm mythtv-0.23/bindings/perl/MythTV/Channel.pm
--- mythtv-0.23-release/bindings/perl/MythTV/Channel.pm	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/bindings/perl/MythTV/Channel.pm	2010-05-23 12:42:23.678567000 -0400
@@ -3,10 +3,10 @@
 #
 # Object containing info about a particular MythTV channel.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/bindings/perl/MythTV/Channel.pm $
-# @date      $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
-# @version   $Revision: 20349 $
-# @author    $Author: xris $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/bindings/perl/MythTV/Channel.pm $
+# @date      $Date: 2010-05-23 12:42:23 -0400 (Sun, 23 May 2010) $
+# @version   $Revision: 24810 $
+# @author    $Author: mdean $
 #
 
 # Make sure that the main MythTV package is loaded
@@ -24,36 +24,38 @@ package MythTV::Channel;
         my $data = shift;
 
     # Fields from the channel table
-        $self->{'atsc_major_chan'}  = $data->{'atsc_major_chan'};
-        $self->{'atsc_minor_chan'}  = $data->{'atsc_minor_chan'};
-        $self->{'atscsrcid'}        = $data->{'atscsrcid'};
-        $self->{'brightness'}       = $data->{'brightness'};
-        $self->{'callsign'}         = $data->{'callsign'};
-        $self->{'chanid'}           = $data->{'chanid'};
-        $self->{'channum'}          = $data->{'channum'};
-        $self->{'colour'}           = $data->{'colour'};
-        $self->{'commfree'}         = $data->{'commfree'};
-        $self->{'contrast'}         = $data->{'contrast'};
-        $self->{'finetune'}         = $data->{'finetune'};
-        $self->{'freqid'}           = $data->{'freqid'};
-        $self->{'hue'}              = $data->{'hue'};
-        $self->{'icon'}             = $data->{'icon'};
-        $self->{'mplexid'}          = $data->{'mplexid'};
-        $self->{'name'}             = $data->{'name'};
-        $self->{'outputfilters'}    = $data->{'outputfilters'};
-        $self->{'recpriority'}      = $data->{'recpriority'};
-        $self->{'serviceid'}        = $data->{'serviceid'};
-        $self->{'sourceid'}         = $data->{'sourceid'};
-        $self->{'tmoffset'}         = $data->{'tmoffset'};
-        $self->{'tvformat'}         = $data->{'tvformat'};
-        $self->{'useonairguide'}    = $data->{'useonairguide'};
-        $self->{'videofilters'}     = $data->{'videofilters'};
-        $self->{'visible'}          = $data->{'visible'};
-        $self->{'xmltvid'}          = $data->{'xmltvid'};
+        $self->{'atsc_major_chan'}   = $data->{'atsc_major_chan'};
+        $self->{'atsc_minor_chan'}   = $data->{'atsc_minor_chan'};
+        $self->{'brightness'}        = $data->{'brightness'};
+        $self->{'callsign'}          = $data->{'callsign'};
+        $self->{'chanid'}            = $data->{'chanid'};
+        $self->{'channum'}           = $data->{'channum'};
+        $self->{'colour'}            = $data->{'colour'};
+        $self->{'commmethod'}        = $data->{'commmethod'};
+        $self->{'contrast'}          = $data->{'contrast'};
+        $self->{'default_authority'} = $data->{'default_authority'};
+        $self->{'finetune'}          = $data->{'finetune'};
+        $self->{'freqid'}            = $data->{'freqid'};
+        $self->{'hue'}               = $data->{'hue'};
+        $self->{'icon'}              = $data->{'icon'};
+        $self->{'last_record'}       = $data->{'last_record'};
+        $self->{'mplexid'}           = $data->{'mplexid'};
+        $self->{'name'}              = $data->{'name'};
+        $self->{'outputfilters'}     = $data->{'outputfilters'};
+        $self->{'recpriority'}       = $data->{'recpriority'};
+        $self->{'serviceid'}         = $data->{'serviceid'};
+        $self->{'sourceid'}          = $data->{'sourceid'};
+        $self->{'tmoffset'}          = $data->{'tmoffset'};
+        $self->{'tvformat'}          = $data->{'tvformat'};
+        $self->{'useonairguide'}     = $data->{'useonairguide'};
+        $self->{'videofilters'}      = $data->{'videofilters'};
+        $self->{'visible'}           = $data->{'visible'};
+        $self->{'xmltvid'}           = $data->{'xmltvid'};
 
     # DVB fields, from the dtv_multiplex table
         $self->{'dtv_bandwidth'}            = $data->{'dtv_bandwidth'};
         $self->{'dtv_constellation'}        = $data->{'dtv_constellation'};
+        $self->{'dtv_default_authority'}    = $data->{'dtv_default_authority'};
         $self->{'dtv_fec'}                  = $data->{'dtv_fec'};
         $self->{'dtv_frequency'}            = $data->{'dtv_frequency'};
         $self->{'dtv_guard_interval'}       = $data->{'dtv_guard_interval'};
@@ -62,8 +64,10 @@ package MythTV::Channel;
         $self->{'dtv_inversion'}            = $data->{'dtv_inversion'};
         $self->{'dtv_lp_code_rate'}         = $data->{'dtv_lp_code_rate'};
         $self->{'dtv_modulation'}           = $data->{'dtv_modulation'};
+        $self->{'dtv_mod_sys'}              = $data->{'dtv_mod_sys'};
         $self->{'dtv_networkid'}            = $data->{'dtv_networkid'};
         $self->{'dtv_polarity'}             = $data->{'dtv_polarity'};
+        $self->{'dtv_rolloff'}              = $data->{'dtv_rolloff'};
         $self->{'dtv_serviceversion'}       = $data->{'dtv_serviceversion'};
         $self->{'dtv_sistandard'}           = $data->{'dtv_sistandard'};
         $self->{'dtv_sourceid'}             = $data->{'dtv_sourceid'};
diff -Naurp mythtv-0.23-release/bindings/perl/MythTV/Program.pm mythtv-0.23/bindings/perl/MythTV/Program.pm
--- mythtv-0.23-release/bindings/perl/MythTV/Program.pm	2009-07-06 13:01:48.000000000 -0400
+++ mythtv-0.23/bindings/perl/MythTV/Program.pm	2009-07-06 13:01:48.827558000 -0400
@@ -3,8 +3,8 @@
 #
 # Object containing info about a particular MythTV program.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/bindings/perl/MythTV/Program.pm $
-# @date      $Date: 2009-07-06 10:01:48 -0700 (Mon, 06 Jul 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/bindings/perl/MythTV/Program.pm $
+# @date      $Date: 2009-07-06 13:01:48 -0400 (Mon, 06 Jul 2009) $
 # @version   $Revision: 20795 $
 # @author    $Author: stuartm $
 #
diff -Naurp mythtv-0.23-release/bindings/perl/MythTV/Recording.pm mythtv-0.23/bindings/perl/MythTV/Recording.pm
--- mythtv-0.23-release/bindings/perl/MythTV/Recording.pm	2010-03-21 19:16:27.000000000 -0400
+++ mythtv-0.23/bindings/perl/MythTV/Recording.pm	2010-03-21 19:16:27.821969000 -0400
@@ -3,8 +3,8 @@
 #
 # Object containing info about a particular MythTV recording.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/bindings/perl/MythTV/Recording.pm $
-# @date      $Date: 2010-03-21 16:16:27 -0700 (Sun, 21 Mar 2010) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/bindings/perl/MythTV/Recording.pm $
+# @date      $Date: 2010-03-21 19:16:27 -0400 (Sun, 21 Mar 2010) $
 # @version   $Revision: 23772 $
 # @author    $Author: beirdo $
 #
diff -Naurp mythtv-0.23-release/bindings/perl/MythTV/StorageGroup.pm mythtv-0.23/bindings/perl/MythTV/StorageGroup.pm
--- mythtv-0.23-release/bindings/perl/MythTV/StorageGroup.pm	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/bindings/perl/MythTV/StorageGroup.pm	2009-04-10 20:04:30.069718000 -0400
@@ -3,8 +3,8 @@
 #
 # Object containing info about a particular MythTV Storage Group.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/bindings/perl/MythTV/StorageGroup.pm $
-# @date      $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/bindings/perl/MythTV/StorageGroup.pm $
+# @date      $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 # @version   $Revision: 20349 $
 # @author    $Author: xris $
 #
diff -Naurp mythtv-0.23-release/bindings/perl/MythTV.pm mythtv-0.23/bindings/perl/MythTV.pm
--- mythtv-0.23-release/bindings/perl/MythTV.pm	2010-03-01 17:17:19.000000000 -0500
+++ mythtv-0.23/bindings/perl/MythTV.pm	2010-07-16 23:32:13.745324000 -0400
@@ -1,9 +1,9 @@
 #
 # MythTV bindings for perl.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/bindings/perl/MythTV.pm $
-# @date      $Date: 2010-03-01 14:17:19 -0800 (Mon, 01 Mar 2010) $
-# @version   $Revision: 23636 $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/bindings/perl/MythTV.pm $
+# @date      $Date: 2010-07-16 23:32:13 -0400 (Fri, 16 Jul 2010) $
+# @version   $Revision: 25366 $
 # @author    $Author: cpinkham $
 #
 
@@ -101,7 +101,7 @@ package MythTV;
 
 # MYTH_PROTO_VERSION is defined in libmyth in mythtv/libs/libmyth/mythcontext.h
 # and should be the current MythTV protocol version.
-    our $PROTO_VERSION = 56;
+    our $PROTO_VERSION = 23056;
 
 # NUMPROGRAMLINES is defined in mythtv/libs/libmythtv/programinfo.h and is
 # the number of items in a ProgramInfo QStringList group used by
@@ -710,6 +710,7 @@ EOF
         my $sh = $self->{'dbh'}->prepare('SELECT channel.*,
                                                  dtv_multiplex.bandwidth         AS dtv_bandwidth,
                                                  dtv_multiplex.constellation     AS dtv_constellation,
+                                                 dtv_multiplex.default_authority AS dtv_default_authority,
                                                  dtv_multiplex.fec               AS dtv_fec,
                                                  dtv_multiplex.frequency         AS dtv_frequency,
                                                  dtv_multiplex.guard_interval    AS dtv_guard_interval,
@@ -718,8 +719,10 @@ EOF
                                                  dtv_multiplex.inversion         AS dtv_inversion,
                                                  dtv_multiplex.lp_code_rate      AS dtv_lp_code_rate,
                                                  dtv_multiplex.modulation        AS dtv_modulation,
+                                                 dtv_multiplex.mod_sys           AS dtv_mod_sys,
                                                  dtv_multiplex.networkid         AS dtv_networkid,
                                                  dtv_multiplex.polarity          AS dtv_polarity,
+                                                 dtv_multiplex.rolloff           AS dtv_rolloff,
                                                  dtv_multiplex.serviceversion    AS dtv_serviceversion,
                                                  dtv_multiplex.sistandard        AS dtv_sistandard,
                                                  dtv_multiplex.sourceid          AS dtv_sourceid,
diff -Naurp mythtv-0.23-release/bindings/python/MythTV/__init__.py mythtv-0.23/bindings/python/MythTV/__init__.py
--- mythtv-0.23-release/bindings/python/MythTV/__init__.py	2010-05-03 01:03:57.000000000 -0400
+++ mythtv-0.23/bindings/python/MythTV/__init__.py	2010-06-21 23:35:41.632640000 -0400
@@ -36,6 +36,9 @@ if version_info >= (2, 6): # 2.6 or newe
 else:
     exec(import25)
 
+__version__ = OWN_VERSION
+MythStatic.mysqldb = MySQLdb.__version__
+
 if __name__ == '__main__':
     banner = 'MythTV Python interactive shell.'
     import code
diff -Naurp mythtv-0.23-release/bindings/python/MythTV/MythData.py mythtv-0.23/bindings/python/MythTV/MythData.py
--- mythtv-0.23-release/bindings/python/MythTV/MythData.py	2010-04-21 00:46:55.000000000 -0400
+++ mythtv-0.23/bindings/python/MythTV/MythData.py	2010-06-06 20:03:02.104550000 -0400
@@ -175,7 +175,7 @@ class FileTransfer( MythBEConn ):
         if not self.open:
             return
         self.control.backendCommand('QUERY_FILETRANSFER '\
-                    +BACKEND_SEP.join([str(self.sockno), 'JOIN']))
+                    +BACKEND_SEP.join([str(self.sockno), 'DONE']))
         self.socket.shutdown(1)
         self.socket.close()
         self.open = False
@@ -526,6 +526,8 @@ class Program( DictData ):
         if type != 'r':
             raise MythFileError(MythError.FILE_FAILED_WRITE, self.filename, 
                             'Program () objects cannot be opened for writing')
+        if not self.filename.startswith('myth://'):
+            self.filename = 'myth://%s/%s' % (self.hostname, self.filename)
         return ftopen(self.filename, 'r')
 
 class Record( DBDataWrite ):
diff -Naurp mythtv-0.23-release/bindings/python/MythTV/MythFunc.py mythtv-0.23/bindings/python/MythTV/MythFunc.py
--- mythtv-0.23-release/bindings/python/MythTV/MythFunc.py	2010-03-31 15:07:44.000000000 -0400
+++ mythtv-0.23/bindings/python/MythTV/MythFunc.py	2010-05-23 15:52:40.992320000 -0400
@@ -392,13 +392,16 @@ class MythBE( FileOps ):
         'filenames' is a dictionary, where the values are the file sizes.
         """
         def walk(self, host, sg, root, path):
-            dn, fn, fs = self.getSGList(host, sg, root+path+'/')
-            res = [list(dn), dict(zip(fn, fs))]
+            res = self.getSGList(host, sg, root+path+'/')
+            if res < 0:
+                return {}
+            dlist = list(res[0])
+            res = [dlist, dict(zip(res[1],res[2]))]
             if path == '':
                 res = {'/':res}
             else:
                 res = {path:res}
-            for d in dn:
+            for d in dlist:
                 res.update(walk(self, host, sg, root, path+'/'+d))
             return res
 
@@ -820,7 +823,7 @@ class MythDB( MythDBBase ):
 
     def getGuideData(self, chanid, date):
         return self.searchGuide(chanid=chanid, 
-                                custom=('DATE(starttime)=%s',date))
+                                custom=(('DATE(starttime)=%s',date),))
 
     def getSetting(self, value, hostname=None):
         if not hostname:
@@ -996,7 +999,7 @@ class MythVideo( MythDBBase ):
                         tpath = sgfold[0][1:]+'/'+sgfile
 
                     # filter by extension
-                    if tpath.rsplit('.',1)[1].lower() not in extensions:
+                    if tpath.rsplit('.',1)[-1].lower() not in extensions:
                         #print 'skipping: '+tpath
                         continue
 
diff -Naurp mythtv-0.23-release/bindings/python/MythTV/MythStatic.py mythtv-0.23/bindings/python/MythTV/MythStatic.py
--- mythtv-0.23-release/bindings/python/MythTV/MythStatic.py	2010-01-29 20:25:12.000000000 -0500
+++ mythtv-0.23/bindings/python/MythTV/MythStatic.py	2010-07-16 23:32:13.745324000 -0400
@@ -4,9 +4,10 @@
 Contains any static and global variables for MythTV Python Bindings
 """
 
+OWN_VERSION = (0,23,0,0)
 SCHEMA_VERSION = 1254
 MVSCHEMA_VERSION = 1032
 NVSCHEMA_VERSION = 1004
-PROTO_VERSION = 56
+PROTO_VERSION = 23056
 PROGRAM_FIELDS = 47
 BACKEND_SEP = '[]:[]'
diff -Naurp mythtv-0.23-release/bindings/python/scripts/mythpython mythtv-0.23/bindings/python/scripts/mythpython
--- mythtv-0.23-release/bindings/python/scripts/mythpython	1969-12-31 19:00:00.000000000 -0500
+++ mythtv-0.23/bindings/python/scripts/mythpython	2010-07-17 03:13:11.297668000 -0400
@@ -0,0 +1,34 @@
+#!/usr/bin/env python
+
+from MythTV import *
+import sys
+
+if __name__ == '__main__':
+    if '--version' in sys.argv:
+        print 'MythTV Python Bindings'
+        print '  local versions'
+        print '    bindings version:  ', '.'.join([str(i) for i in MythStatic.OWN_VERSION])
+        import MythTV.ttvdb.tvdb_api
+        print '    ttvdb version:     ', str(MythTV.ttvdb.tvdb_api.__version__)
+        import MythTV.tmdb.tmdb_api
+        print '    tmdb version:      ', str(MythTV.tmdb.tmdb_api.__version__)
+        print '  external versions'
+        try:
+            import lxml.etree
+            print '    lxml version:      ', str(lxml.etree.__version__)
+        except:
+            print '    lxml version:      ', 'NOT FOUND'
+        print '    MySQLdb version:   ', '.'.join([str(i) for i in MythStatic.mysqldb])
+        sys.exit(0)
+    banner = 'MythTV Python interactive shell.'
+    import code
+    try:
+        import readline, rlcompleter
+    except:
+        pass
+    else:
+        readline.parse_and_bind("tab: complete")
+        banner += ' TAB completion available.'
+    namespace = globals().copy()
+    namespace.update(locals())
+    code.InteractiveConsole(namespace).interact(banner)
diff -Naurp mythtv-0.23-release/bindings/python/setup.py mythtv-0.23/bindings/python/setup.py
--- mythtv-0.23-release/bindings/python/setup.py	2010-01-28 20:39:37.000000000 -0500
+++ mythtv-0.23/bindings/python/setup.py	2010-06-21 23:35:41.632640000 -0400
@@ -8,4 +8,5 @@ setup(
         description='MythTV Python bindings.',
         packages=['MythTV', 'MythTV/tmdb', 'MythTV/ttvdb'],
         url=['http://www.mythtv.org/'],
+        scripts=['scripts/mythpython'],
         )
diff -Naurp mythtv-0.23-release/configure mythtv-0.23/configure
--- mythtv-0.23-release/configure	2010-05-05 11:59:55.000000000 -0400
+++ mythtv-0.23/configure	2010-06-28 02:48:30.735925000 -0400
@@ -730,12 +730,12 @@ EOF
 
 check_ld_cxx(){
     log check_ld_cxx "$@"
-    check_cxx || return
     flags=''
     libs=''
     for f; do
         test "${f}" = "${f#-l}" && flags="$flags $f" || libs="$libs $f"
     done
+    check_cxx $($filter_cflags $flags) || return
     check_cmd $cxx $LDFLAGS $flags -o $TMPE $TMPO $extralibs $libs
 }
 
@@ -1561,7 +1561,7 @@ libdirac_encoder_deps="libdirac"
 libfaac_encoder_deps="libfaac"
 libfaad_decoder_deps="libfaad"
 libfaad_latm_decoder_deps="libfaad"
-libfaadbin_decoder_extralibs='$ldl'
+libfaadbin_extralibs='$ldl'
 libgsm_decoder_deps="libgsm"
 libgsm_encoder_deps="libgsm"
 libgsm_ms_decoder_deps="libgsm"
@@ -2473,6 +2473,8 @@ if ! enabled_any cpu_override cross_comp
        cpu="athlon"
        enable small
 # Athlon 64
+   elif expr "$processor" : ".*AMD Athlon(tm) II" > /dev/null ; then
+       cpu="k8"
    elif expr "$processor" : ".*AMD Athlon(tm) 64" > /dev/null ; then
        cpu="k8"
    elif expr "$processor" : ".*AMD Athlon(tm) Dual Core" > /dev/null ; then
@@ -3763,12 +3765,13 @@ enabled freetype2 ||
 enabled lamemp3 && check_lib2 lame/lame.h lame_init -lmp3lame -lm ||
     die "ERROR! You must have the Lame MP3 encoding library installed to compile MythTV."
 
+# Qt dependency checks
+qt_inc="-I${sysroot}/$(${qmake} -query QT_INSTALL_HEADERS)"
+qt_libs="-L${sysroot}/$(${qmake} -query QT_INSTALL_LIBS)"
+
 if $(pkg-config --atleast-version 4.4.0 QtWebKit) ; then
     enable qtwebkit
 else
-    # For environments that don't have pkg-config, we do a compile test.
-    qt_inc="-I${sysroot}/$(${qmake} -query QT_INSTALL_HEADERS)"
-
     check_cxx ${qt_inc} ${qt_inc}/QtCore <<EOF && enable qtwebkit
 #include <QtWebKit/QtWebKit>
 #if QT_VERSION < 0x040400
@@ -3780,9 +3783,11 @@ fi
 enabled qtwebkit || die "Error! QtWebkit headers not found"
 
 # Check if Qt was built with DBus support:
-qt_inc="-I${sysroot}/$(${qmake} -query QT_INSTALL_HEADERS)"
-check_cxx ${qt_inc} ${qt_inc}/QtDBus <<EOF && enable qtdbus
+check_ld_cxx ${qt_inc} ${qt_inc}/QtDBus ${qt_libs} -lQtDBus <<EOF && enable qtdbus
 #include <QtDBus>
+int main(void){
+    return (long) QDBusConnection::disconnectFromBus;
+}
 EOF
 
 if enabled firewire; then
@@ -3844,7 +3849,7 @@ if test x"$xvmc_lib" != x""; then
     VENDOR_XVMC_LIBS="-l"$xvmc_lib
     disable xvmcw
 elif enabled xvmcw; then
-    VENDOR_XVMC_LIBS="-lXvMCW $ldl"
+    VENDOR_XVMC_LIBS="-lXvMCW"
 elif enabled xvmc_pro; then
     if has_library libviaXvMCPro ; then
         VENDOR_XVMC_LIBS="-lviaXvMCPro"
@@ -4312,6 +4317,7 @@ SDL_LIBS=$sdl_libs
 SDL_CFLAGS=$sdl_cflags
 LIB_INSTALL_EXTRA_CMD=$LIB_INSTALL_EXTRA_CMD
 EXTRALIBS=$extralibs
+EXTRA_LIBS=$ldl
 EOF
 
 get_version(){
diff -Naurp mythtv-0.23-release/contrib/config_files/lirc/lircrc.native.example.mceusb2 mythtv-0.23/contrib/config_files/lirc/lircrc.native.example.mceusb2
--- mythtv-0.23-release/contrib/config_files/lirc/lircrc.native.example.mceusb2	2008-03-08 23:30:22.000000000 -0500
+++ mythtv-0.23/contrib/config_files/lirc/lircrc.native.example.mceusb2	2008-03-08 23:30:22.515246000 -0500
@@ -2,7 +2,7 @@
 # lircrc config file for the Microsoft Media Center Edition Remote, model 1039
 #
 # @url       $URL$
-# @date      $Date: 2008-03-08 20:30:22 -0800 (Sat, 08 Mar 2008) $
+# @date      $Date: 2008-03-08 23:30:22 -0500 (Sat, 08 Mar 2008) $
 # @version   $Revision: 16474 $
 # @author    $Author: kormoc $
 #
diff -Naurp mythtv-0.23-release/contrib/icons/master_iconmap/channel_icons.pl mythtv-0.23/contrib/icons/master_iconmap/channel_icons.pl
--- mythtv-0.23-release/contrib/icons/master_iconmap/channel_icons.pl	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/contrib/icons/master_iconmap/channel_icons.pl	2009-04-10 20:04:30.069718000 -0400
@@ -5,8 +5,8 @@
 # Also does searches for artwork URLs based on callsign or xmltvid, or displays
 # the master iconmap xml file from services.mythtv.org.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/contrib/icons/master_iconmap/channel_icons.pl $
-# @date      $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/contrib/icons/master_iconmap/channel_icons.pl $
+# @date      $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 # @version   $Revision: 20349 $
 # @author    $Author: xris $
 # @copyright MythTV
diff -Naurp mythtv-0.23-release/contrib/maintenance/flush_deleted_recgroup.pl mythtv-0.23/contrib/maintenance/flush_deleted_recgroup.pl
--- mythtv-0.23-release/contrib/maintenance/flush_deleted_recgroup.pl	2009-10-05 18:36:40.000000000 -0400
+++ mythtv-0.23/contrib/maintenance/flush_deleted_recgroup.pl	2009-10-05 18:36:40.691937000 -0400
@@ -2,8 +2,8 @@
 #
 # Tell MythTV to truly delete all recordings in the "Deleted" recgroup
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/contrib/maintenance/flush_deleted_recgroup.pl $
-# @date      $Date: 2009-10-05 15:36:40 -0700 (Mon, 05 Oct 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/contrib/maintenance/flush_deleted_recgroup.pl $
+# @date      $Date: 2009-10-05 18:36:40 -0400 (Mon, 05 Oct 2009) $
 # @version   $Revision: 22260 $
 # @author    $Author: mdean $
 #
diff -Naurp mythtv-0.23-release/contrib/maintenance/optimize_mythdb.pl mythtv-0.23/contrib/maintenance/optimize_mythdb.pl
--- mythtv-0.23-release/contrib/maintenance/optimize_mythdb.pl	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/contrib/maintenance/optimize_mythdb.pl	2009-04-10 20:04:30.069718000 -0400
@@ -3,8 +3,8 @@
 # Connects to the mythtv database and repairs/optimizes the tables that it
 # finds.  Suggested use is to cron it to run once per day.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/contrib/maintenance/optimize_mythdb.pl $
-# @date      $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/contrib/maintenance/optimize_mythdb.pl $
+# @date      $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 # @version   $Revision: 20349 $
 # @author    $Author: xris $
 # @license   GPL
diff -Naurp mythtv-0.23-release/contrib/user_jobs/firewire_primer.pl mythtv-0.23/contrib/user_jobs/firewire_primer.pl
--- mythtv-0.23-release/contrib/user_jobs/firewire_primer.pl	2009-10-22 12:46:34.000000000 -0400
+++ mythtv-0.23/contrib/user_jobs/firewire_primer.pl	2009-10-22 12:46:34.011528000 -0400
@@ -9,8 +9,8 @@
 # hardware, failed marriages due to MythTV not recording your wife's favorite
 # show, etc.
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/contrib/user_jobs/firewire_primer.pl $
-# @date      $Date: 2009-10-22 09:46:34 -0700 (Thu, 22 Oct 2009) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/contrib/user_jobs/firewire_primer.pl $
+# @date      $Date: 2009-10-22 12:46:34 -0400 (Thu, 22 Oct 2009) $
 # @version   $Revision: 22568 $
 # @author    $Author: robertm $
 # @license   GPL
diff -Naurp mythtv-0.23-release/contrib/user_jobs/mythlink.pl mythtv-0.23/contrib/user_jobs/mythlink.pl
--- mythtv-0.23-release/contrib/user_jobs/mythlink.pl	2010-02-04 22:11:23.000000000 -0500
+++ mythtv-0.23/contrib/user_jobs/mythlink.pl	2010-02-04 22:11:23.536986000 -0500
@@ -6,8 +6,8 @@
 # Automatically detects database settings from mysql.txt, and loads
 # the mythtv recording directory from the database (code from nuvexport).
 #
-# @url       $URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/contrib/user_jobs/mythlink.pl $
-# @date      $Date: 2010-02-04 19:11:23 -0800 (Thu, 04 Feb 2010) $
+# @url       $URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/contrib/user_jobs/mythlink.pl $
+# @date      $Date: 2010-02-04 22:11:23 -0500 (Thu, 04 Feb 2010) $
 # @version   $Revision: 23479 $
 # @author    $Author: mdean $
 # @license   GPL
diff -Naurp mythtv-0.23-release/libs/libavcodec/libavcodec.pro mythtv-0.23/libs/libavcodec/libavcodec.pro
--- mythtv-0.23-release/libs/libavcodec/libavcodec.pro	2010-03-12 03:55:46.000000000 -0500
+++ mythtv-0.23/libs/libavcodec/libavcodec.pro	2010-05-13 17:57:24.166134000 -0400
@@ -21,11 +21,10 @@ DEFINES += HAVE_AV_CONFIG_H _LARGEFILE_S
 # -fomit-frame-pointer frees it. gcc-4 enables "location lists"
 # which allows debugging without frame pointer
 debug:contains(ARCH_X86_32, yes) {
-        QMAKE_CFLAGS_SHLIB =
         QMAKE_CFLAGS_DEBUG += -fomit-frame-pointer
 }
-# "-Os" can not compiled with PIC
-contains(CONFIG_SMALL, yes):contains(ARCH_X86_32, yes) {
+# gcc-4.2 and newer can not compile with PIC on x86
+contains(ARCH_X86_32, yes) {
 	QMAKE_CFLAGS_SHLIB =
 }
 
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutputalsa.cpp mythtv-0.23/libs/libmyth/audiooutputalsa.cpp
--- mythtv-0.23-release/libs/libmyth/audiooutputalsa.cpp	2009-11-16 18:00:20.000000000 -0500
+++ mythtv-0.23/libs/libmyth/audiooutputalsa.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -221,13 +221,13 @@ bool AudioOutputALSA::OpenDevice()
     else if (audio_bits == 16)
         // is the sound data coming in really little-endian or is it
         // CPU-endian?
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
         format = SND_PCM_FORMAT_S16;
 #else
         format = SND_PCM_FORMAT_S16_LE;
 #endif
     else if (audio_bits == 24)
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
         format = SND_PCM_FORMAT_S24;
 #else
         format = SND_PCM_FORMAT_S24_LE;
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutputbase.cpp mythtv-0.23/libs/libmyth/audiooutputbase.cpp
--- mythtv-0.23-release/libs/libmyth/audiooutputbase.cpp	2010-04-14 06:36:02.000000000 -0400
+++ mythtv-0.23/libs/libmyth/audiooutputbase.cpp	2010-06-18 06:50:18.720005000 -0400
@@ -848,7 +848,8 @@ bool AudioOutputBase::AddSamples(char *b
     {
         // Convert to floats
         short *buf_ptr = (short*)buffer;
-        for (int sample = 0; sample < samples * audio_channels; sample++)
+        int numSamples = (samples * abps) / sizeof(short);
+        for (int sample = 0; sample < numSamples; sample++)
         {
             src_in[sample] = (float)buf_ptr[sample] / (1.0 * 0x8000);
         }
@@ -861,7 +862,7 @@ bool AudioOutputBase::AddSamples(char *b
                     QString("Error occurred while resampling audio: %1")
                     .arg(src_strerror(error)));
         src_float_to_short_array(src_data.data_out, (short int*)tmp_buff,
-                                 src_data.output_frames_gen*audio_channels);
+                            (src_data.output_frames_gen*abps)/sizeof(short));
 
         _AddSamples(tmp_buff, true, src_data.output_frames_gen, timecode);
     }
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutputbase.h mythtv-0.23/libs/libmyth/audiooutputbase.h
--- mythtv-0.23-release/libs/libmyth/audiooutputbase.h	2009-11-14 04:49:04.000000000 -0500
+++ mythtv-0.23/libs/libmyth/audiooutputbase.h	2010-06-18 06:50:18.720005000 -0400
@@ -57,6 +57,7 @@ class AudioOutputBase : public AudioOutp
     virtual void SetTimecode(long long timecode);
     virtual bool IsPaused(void) const { return audio_actually_paused; }
     virtual void Pause(bool paused);
+    virtual bool CanPassthrough(void) const { return !need_resampler; }
 
     // Wait for all data to finish playing
     virtual void Drain(void);
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutputca.cpp mythtv-0.23/libs/libmyth/audiooutputca.cpp
--- mythtv-0.23-release/libs/libmyth/audiooutputca.cpp	2009-09-25 14:08:46.000000000 -0400
+++ mythtv-0.23/libs/libmyth/audiooutputca.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -14,7 +14,7 @@
  * fails and passthru was set.
  *
  * = REVISION
- * $Id: audiooutputca.cpp 22041 2009-09-25 18:08:46Z rkulagow $
+ * $Id: audiooutputca.cpp 25186 2010-06-28 07:29:58Z jyavenard $
  *
  * = AUTHORS
  * Jeremiah Morris, Andrew Kimpton, Nigel Pearson
@@ -176,7 +176,7 @@ bool CoreAudioData::OpenAnalog()
     conv_in_desc.mSampleRate       = mCA->audio_samplerate;
     conv_in_desc.mFormatID         = kAudioFormatLinearPCM;
     conv_in_desc.mFormatFlags      = kLinearPCMFormatFlagIsSignedInteger;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     conv_in_desc.mFormatFlags     |= kLinearPCMFormatFlagIsBigEndian;
 #endif
     conv_in_desc.mBytesPerPacket   = mCA->audio_bytes_per_sample;
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutput.h mythtv-0.23/libs/libmyth/audiooutput.h
--- mythtv-0.23-release/libs/libmyth/audiooutput.h	2009-10-13 22:57:05.000000000 -0400
+++ mythtv-0.23/libs/libmyth/audiooutput.h	2010-06-18 06:50:18.720005000 -0400
@@ -49,6 +49,7 @@ class MPUBLIC AudioOutput : public Volum
     virtual void SetTimecode(long long timecode) = 0;
     virtual bool IsPaused(void) const = 0;
     virtual void Pause(bool paused) = 0;
+    virtual bool CanPassthrough(void) const = 0;
  
     // Wait for all data to finish playing
     virtual void Drain(void) = 0;
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutputoss.cpp mythtv-0.23/libs/libmyth/audiooutputoss.cpp
--- mythtv-0.23-release/libs/libmyth/audiooutputoss.cpp	2009-10-13 22:57:05.000000000 -0400
+++ mythtv-0.23/libs/libmyth/audiooutputoss.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -123,7 +123,7 @@ bool AudioOutputOSS::OpenDevice()
             format = AFMT_S8;
             break;
         case 16:
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
             format = AFMT_S16_BE;
 #else
             format = AFMT_S16_LE;
diff -Naurp mythtv-0.23-release/libs/libmyth/audiooutputpulse.cpp mythtv-0.23/libs/libmyth/audiooutputpulse.cpp
--- mythtv-0.23-release/libs/libmyth/audiooutputpulse.cpp	2009-11-16 11:18:35.000000000 -0500
+++ mythtv-0.23/libs/libmyth/audiooutputpulse.cpp	2010-06-07 23:31:50.923907000 -0400
@@ -554,9 +554,16 @@ bool AudioOutputPulseAudio::ConnectPlayb
     else
         pa_cvolume_reset(&volume_control, audio_channels);
 
-    // set myth sizes and pa buffer metrics
-    fragment_size = (float)sample_rate * 0.020f * // 20msec
-        (float)(audio_bits / 8 * audio_channels);
+    // set myth sizes and pa buffer metrics (20 ms)
+    // Note: The 20 is an unsigned long (at least 32 bits).
+    // sample_rate, audio_bits and audio_channels are at least
+    // that size, so the math will be done with a range of at
+    // least 2 billion. If we assume a max audio_bits of 32,
+    // audio_channels of 16 and sample_rate of <= 448000, then
+    // the largest number will be 230 million, well within range.
+    fragment_size = 20UL * sample_rate * audio_bits * audio_channels
+        / 8 /* 8 bits per byte */ / 1000 /* 1000 ms per second */;
+
     soundcard_buffer_size = 16 * fragment_size;
     buffer_settings.maxlength = soundcard_buffer_size;
     buffer_settings.tlength = fragment_size * 4;
diff -Naurp mythtv-0.23-release/libs/libmyth/mediamonitor-darwin.cpp mythtv-0.23/libs/libmyth/mediamonitor-darwin.cpp
--- mythtv-0.23-release/libs/libmyth/mediamonitor-darwin.cpp	2009-11-28 10:55:09.000000000 -0500
+++ mythtv-0.23/libs/libmyth/mediamonitor-darwin.cpp	2010-06-17 23:48:36.374058000 -0400
@@ -1,7 +1,7 @@
 /**
  * \file     mediamonitor-darwin.cpp
  * \brief    MythMediaMonitor for Darwin/Mac OS X.
- * \version  $Id: mediamonitor-darwin.cpp 22911 2009-11-28 15:55:09Z danielk $
+ * \version  $Id: mediamonitor-darwin.cpp 25132 2010-06-18 03:48:36Z nigel $
  * \author   Andrew Kimpton, Nigel Pearson
  */
 
@@ -178,11 +178,11 @@ static char * getVolName(CFDictionaryRef
 
     name = (CFStringRef)
            CFDictionaryGetValue(diskDetails, kDADiskDescriptionVolumeNameKey);
-    if (name)
-        size = CFStringGetLength(name) + 1;
-    else
-        size = 9;  // 'Untitled\0'
 
+    if (!name)
+        return NULL;
+
+    size = CFStringGetLength(name) + 1;
     volName = (char *) malloc(size);
     if (!volName)
     {
@@ -191,9 +191,11 @@ static char * getVolName(CFDictionaryRef
         return NULL;
     }
 
-    if (!name || !CFStringGetCString(name, volName, size,
-                                     kCFStringEncodingUTF8))
-        strcpy(volName, "Untitled");
+    if (!CFStringGetCString(name, volName, size, kCFStringEncodingUTF8))
+    {
+        free(volName);
+        return NULL;
+    }
 
     return volName;
 }
@@ -291,8 +293,14 @@ void diskAppearedCallback(DADiskRef disk
 
     // Get the volume and model name for more user-friendly interaction
     volName = getVolName(details);
-    model   = getModel(details);
+    if (!volName)
+    {
+        VERBOSE(VB_MEDIA, msg + "No volume name for dev " + BSDname);
+        CFRelease(details);
+        return;
+    }
 
+    model     = getModel(details);
     mediaType = MediaTypeForBSDName(BSDname);
     isCDorDVD = (mediaType == MEDIATYPE_DVD) || (mediaType == MEDIATYPE_AUDIO);
 
@@ -326,6 +334,9 @@ void diskChangedCallback(DADiskRef disk,
         CFDictionaryRef details = DADiskCopyDescription(disk);
         char           *volName = getVolName(details);
 
+        VERBOSE(VB_MEDIA, QString("Disk %1 - changed name to '%2'.")
+                          .arg(BSDname).arg(volName));
+
         reinterpret_cast<MonitorThreadDarwin *>(context)
             ->diskRename(BSDname, volName);
         CFRelease(details);
diff -Naurp mythtv-0.23-release/libs/libmyth/mythcdrom-linux.cpp mythtv-0.23/libs/libmyth/mythcdrom-linux.cpp
--- mythtv-0.23-release/libs/libmyth/mythcdrom-linux.cpp	2010-02-03 16:02:18.000000000 -0500
+++ mythtv-0.23/libs/libmyth/mythcdrom-linux.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -12,7 +12,7 @@
 
 #include "mythcdrom.h"
 #include "mythcdrom-linux.h"
-#include "mythconfig.h"      // for WORDS_BIGENDIAN
+#include "mythconfig.h"      // for HAVE_BIGENDIAN
 #include "mythcontext.h"
 #include "mythverbose.h"
 
@@ -35,7 +35,7 @@ typedef struct cdrom_generic_command CDR
 typedef struct
 {
     uint16_t data_len[2];
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     uint8_t  nea                : 1;
     uint8_t  reserved1          : 4;
     uint8_t  notification_class : 3;
@@ -45,7 +45,7 @@ typedef struct
     uint8_t  nea                : 1;
 #endif
     uint8_t  supp_event_class;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     uint8_t  reserved2          : 4;
     uint8_t  media_event_code   : 4;
     uint8_t  reserved3          : 6;
@@ -65,7 +65,7 @@ typedef struct
 // and this is returned by GPCMD_READ_DISC_INFO
 typedef struct {
     uint16_t disc_information_length;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     uint8_t  reserved1          : 3;
     uint8_t  erasable           : 1;
     uint8_t  border_status      : 2;
@@ -80,7 +80,7 @@ typedef struct {
     uint8_t  n_sessions_lsb;
     uint8_t  first_track_lsb;
     uint8_t  last_track_lsb;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     uint8_t  did_v              : 1;
     uint8_t  dbc_v              : 1;
     uint8_t  uru                : 1;
diff -Naurp mythtv-0.23-release/libs/libmyth/mythcontext.cpp mythtv-0.23/libs/libmyth/mythcontext.cpp
--- mythtv-0.23-release/libs/libmyth/mythcontext.cpp	2010-03-23 20:43:43.000000000 -0400
+++ mythtv-0.23/libs/libmyth/mythcontext.cpp	2010-05-14 18:39:42.189261000 -0400
@@ -1426,7 +1426,12 @@ bool MythContext::Init(const bool gui, U
     }
 #endif
 
-    if (QDir::homePath() == "/" && ! getenv("MYTHCONFDIR"))
+    // If HOME isn't defined, we won't be able to use default confdir of
+    // $HOME/.mythtv nor can we rely on a MYTHCONFDIR that references $HOME
+    QString homedir = QDir::homePath();
+    QString confdir = getenv("MYTHCONFDIR");
+    if ((homedir.isEmpty() || homedir == "/") &&
+        (confdir.isEmpty() || confdir.contains("$HOME")))
     {
         QString warning = "Cannot locate your home directory."
                           " Please set the environment variable HOME";
@@ -1435,7 +1440,7 @@ bool MythContext::Init(const bool gui, U
             d->TempMainWindow(false);
             MythPopupBox::showOkPopup(d->mainWindow, "HOME error", warning);
         }
-        VERBOSE(VB_IMPORTANT, warning + " or MYTHCONFDIR");
+        VERBOSE(VB_IMPORTANT, warning);
 
         return false;
     }
diff -Naurp mythtv-0.23-release/libs/libmyth/programinfo.cpp mythtv-0.23/libs/libmyth/programinfo.cpp
--- mythtv-0.23-release/libs/libmyth/programinfo.cpp	2010-04-29 10:36:10.000000000 -0400
+++ mythtv-0.23/libs/libmyth/programinfo.cpp	2010-07-16 22:09:27.287638000 -0400
@@ -1377,7 +1377,7 @@ bool ProgramInfo::LoadProgramFromRecorde
         "       r.editing,          r.bookmark,    r.watched,         "//31-33
         "       r.preserve,         r.transcoded,  r.deletepending,   "//34-36
         "       p.audioprop+0,      p.videoprop+0, p.subtitletypes+0, "//37-39
-        "       p.airdate                                             "//40
+        "       p.airdate,          r.findid                          "//40-41
         "FROM recorded AS r "
         "LEFT JOIN (channel AS c, recordedprogram AS p) "
         "ON (r.chanid    = c.chanid AND "
@@ -1474,6 +1474,7 @@ bool ProgramInfo::LoadProgramFromRecorde
     storagegroup = query.value(27).toString();
     playgroup    = query.value(21).toString();
     recpriority  = query.value(22).toInt();
+    findid       = query.value(41).toInt();
 
     QString old_basename = pathname.section('/', -1);
     QString new_basename = query.value(25).toString();
diff -Naurp mythtv-0.23-release/libs/libmyth/remoteutil.cpp mythtv-0.23/libs/libmyth/remoteutil.cpp
--- mythtv-0.23-release/libs/libmyth/remoteutil.cpp	2009-12-29 12:03:57.000000000 -0500
+++ mythtv-0.23/libs/libmyth/remoteutil.cpp	2010-07-16 22:09:27.287638000 -0400
@@ -133,14 +133,16 @@ bool RemoteCheckFile(const ProgramInfo *
 }
 
 bool RemoteDeleteRecording(
-    uint chanid, const QDateTime &recstartts, bool forceMetadataDelete)
+    uint chanid, const QDateTime &recstartts, bool forceMetadataDelete,
+    bool forgetHistory)
 {
     bool result = true;
     QString cmd =
-        QString("DELETE_RECORDING %1 %2 %3")
+        QString("DELETE_RECORDING %1 %2 %3 %4")
         .arg(chanid)
         .arg(recstartts.toString(Qt::ISODate))
-        .arg(forceMetadataDelete ? "FORCE" : "NO_FORCE");
+        .arg(forceMetadataDelete ? "FORCE" : "NO_FORCE")
+        .arg(forgetHistory ? "FORGET" : "NO_FORGET");
     QStringList strlist(cmd);
 
     if (!gContext->SendReceiveStringList(strlist) || strlist.empty())
diff -Naurp mythtv-0.23-release/libs/libmyth/remoteutil.h mythtv-0.23/libs/libmyth/remoteutil.h
--- mythtv-0.23-release/libs/libmyth/remoteutil.h	2009-12-29 12:03:57.000000000 -0500
+++ mythtv-0.23/libs/libmyth/remoteutil.h	2010-07-16 22:09:27.287638000 -0400
@@ -39,7 +39,8 @@ bool RemoteGetMemStats(int &totalMB, int
 MPUBLIC bool RemoteCheckFile(
     const ProgramInfo *pginfo, bool checkSlaves = true);
 MPUBLIC bool RemoteDeleteRecording(
-    uint chanid, const QDateTime &recstartts, bool forceMetadataDelete);
+    uint chanid, const QDateTime &recstartts, bool forceMetadataDelete,
+    bool forgetHistory);
 MPUBLIC
 bool RemoteUndeleteRecording(uint chanid, const QDateTime &recstartts);
 MPUBLIC
diff -Naurp mythtv-0.23-release/libs/libmyth/schemawizard.cpp mythtv-0.23/libs/libmyth/schemawizard.cpp
--- mythtv-0.23-release/libs/libmyth/schemawizard.cpp	2010-01-22 12:12:23.000000000 -0500
+++ mythtv-0.23/libs/libmyth/schemawizard.cpp	2010-06-06 00:54:24.555359000 -0400
@@ -261,6 +261,15 @@ SchemaUpgradeWizard::PromptForUpgrade(co
         return MYTH_SCHEMA_USE_EXISTING;
 #endif
 
+    // Only back up the database if we haven't already successfully made a
+    // backup and the database is old/about to be upgraded (not if it's too
+    // new) or if a user is doing something they probably shouldn't ("expert
+    // mode")
+    if (((backupStatus == kDB_Backup_Unknown) ||
+         (backupStatus == kDB_Backup_Failed)) &&
+        ((upgradeAllowed && (versionsBehind > 0)) ||
+         m_expertMode))
+        BackupDB();
 
     connections = CountClients() > 1;
     gui         = GetMythUI()->IsScreenSetup() && gContext->GetMainWindow();
@@ -314,6 +323,14 @@ SchemaUpgradeWizard::PromptForUpgrade(co
             return MYTH_SCHEMA_EXIT;
         }
 
+        if (versionsBehind < 0)
+        {
+            VERBOSE(VB_IMPORTANT, QString("Error: MythTV database has newer "
+                    "%1 schema (%2) than expected (%3).")
+                    .arg(name).arg(DBver).arg(m_newSchemaVer));
+            return MYTH_SCHEMA_ERROR;
+        }
+
         if (upgradeIfNoUI && validDBMS)
         {
             VERBOSE(VB_IMPORTANT, "Upgrading.");
diff -Naurp mythtv-0.23-release/libs/libmythdb/mythdirs.cpp mythtv-0.23/libs/libmythdb/mythdirs.cpp
--- mythtv-0.23-release/libs/libmythdb/mythdirs.cpp	2009-11-28 10:55:09.000000000 -0500
+++ mythtv-0.23/libs/libmythdb/mythdirs.cpp	2010-05-14 18:39:42.189261000 -0400
@@ -37,8 +37,7 @@ void InitializeMythDirs(void)
     if (QDir(installprefix).isRelative())
     {
         // If the PREFIX is relative, evaluate it relative to our
-        // executable directory. This can be fragile on Unix, so#include <QMutex>
-
+        // executable directory. This can be fragile on Unix, so
         // use relative PREFIX values with care.
 
         VERBOSE(VB_IMPORTANT+VB_EXTRA,
@@ -54,7 +53,7 @@ void InitializeMythDirs(void)
     if (tmp_confdir)
     {
         confdir = QString(tmp_confdir);
-        //VERBOSE(VB_IMPORTANT, QString("Read conf dir = %1").arg(dir));
+        VERBOSE(VB_IMPORTANT, QString("Read conf dir = %1").arg(confdir));
         confdir.replace("$HOME", QDir::homePath());
     }
     else
diff -Naurp mythtv-0.23-release/libs/libmythdb/mythsocket.cpp mythtv-0.23/libs/libmythdb/mythsocket.cpp
--- mythtv-0.23-release/libs/libmythdb/mythsocket.cpp	2010-02-10 12:02:19.000000000 -0500
+++ mythtv-0.23/libs/libmythdb/mythsocket.cpp	2010-06-17 09:23:59.559532000 -0400
@@ -34,6 +34,7 @@ MythSocketThread *MythSocket::s_readyrea
 
 MythSocket::MythSocket(int socket, MythSocketCBs *cb)
     : MSocketDevice(MSocketDevice::Stream),            m_cb(cb),
+      m_useReadyReadCallback(true),
       m_state(Idle),         m_addr(),                 m_port(0),
       m_ref_count(0),        m_notifyread(false)
 {
@@ -200,6 +201,24 @@ void MythSocket::close(void)
     }
 }
 
+bool MythSocket::closedByRemote(void)
+{
+    fd_set rfds;
+    FD_ZERO(&rfds);
+    FD_SET(socket(), &rfds);
+
+    struct timeval to;
+    to.tv_sec = 0;
+    to.tv_usec = 1000;
+
+    int rval = select(socket() + 1, &rfds, NULL, NULL, &to);
+
+    if (rval > 0 && FD_ISSET(socket(), &rfds) && !bytesAvailable())
+        return true;
+
+    return false;
+}
+
 qint64 MythSocket::readBlock(char *data, quint64 len)
 {
     VERBOSE(VB_SOCKET|VB_EXTRA, LOC + QString("readBlock(0x%1, %2) called")
diff -Naurp mythtv-0.23-release/libs/libmythdb/mythsocket.h mythtv-0.23/libs/libmythdb/mythsocket.h
--- mythtv-0.23-release/libs/libmythdb/mythsocket.h	2009-11-16 11:18:35.000000000 -0500
+++ mythtv-0.23/libs/libmythdb/mythsocket.h	2010-06-17 09:23:59.559532000 -0400
@@ -29,6 +29,7 @@ class MPUBLIC MythSocket : public MSocke
     };
 
     void close(void);
+    bool closedByRemote(void);
     void deleteLater(void);
 
     void UpRef(void);
@@ -43,6 +44,8 @@ class MPUBLIC MythSocket : public MSocke
 
     void setSocket(int socket, Type type = MSocketDevice::Stream);
     void setCallbacks(MythSocketCBs *cb);
+    void useReadyReadCallback(bool useReadyReadCallback = true)
+        { m_useReadyReadCallback = useReadyReadCallback; }
 
     qint64 readBlock(char *data, quint64 len);
     qint64 writeBlock(const char *data, quint64 len);
@@ -73,6 +76,7 @@ class MPUBLIC MythSocket : public MSocke
     void  setState(const State state);
 
     MythSocketCBs  *m_cb;
+    bool            m_useReadyReadCallback;
     State           m_state;
     QHostAddress    m_addr;
     quint16         m_port;
diff -Naurp mythtv-0.23-release/libs/libmythdb/mythsocketthread.cpp mythtv-0.23/libs/libmythdb/mythsocketthread.cpp
--- mythtv-0.23-release/libs/libmythdb/mythsocketthread.cpp	2010-02-10 12:02:19.000000000 -0500
+++ mythtv-0.23/libs/libmythdb/mythsocketthread.cpp	2010-06-17 09:23:59.559532000 -0400
@@ -153,12 +153,12 @@ void MythSocketThread::ReadyToBeRead(Myt
     VERBOSE(VB_SOCKET, SLOC(sock) + "socket is readable");
     int bytesAvail = sock->bytesAvailable();
     
-    if (bytesAvail == 0)
+    if (bytesAvail == 0 && sock->closedByRemote())
     {
         VERBOSE(VB_SOCKET, SLOC(sock) + "socket closed");
         sock->close();
     }
-    else if (sock->m_cb)
+    else if (bytesAvail > 0 && sock->m_cb && sock->m_useReadyReadCallback)
     {
         sock->m_notifyread = true;
         VERBOSE(VB_SOCKET, SLOC(sock) + "calling m_cb->readyRead()");
diff -Naurp mythtv-0.23-release/libs/libmythdb/mythversion.h mythtv-0.23/libs/libmythdb/mythversion.h
--- mythtv-0.23-release/libs/libmythdb/mythversion.h	2010-04-29 20:59:58.000000000 -0400
+++ mythtv-0.23/libs/libmythdb/mythversion.h	2010-07-16 23:32:13.745324000 -0400
@@ -9,9 +9,9 @@
 #endif
 
 /// Update this whenever the plug-in API changes.
-/// Including changes in the libmythdb, libmyth and libmythui class methods
-/// used by plug-ins.
-#define MYTH_BINARY_VERSION "0.23.20100429-1"
+/// Including changes in the libmythdb, libmyth, libmythtv, libmythav* and
+/// libmythui class methods used by plug-ins.
+#define MYTH_BINARY_VERSION "0.23.201000710-1"
 
 /** \brief Increment this whenever the MythTV network protocol changes.
  *
@@ -27,10 +27,10 @@
  *       mythtv/bindings/perl/MythTV/Program.pm (layout)
  *
  *   MythTV Python Bindings
- *       mythtv/bindings/python/MythTV/MythTV.py (version number)
- *       mythtv/bindings/python/MythTV/MythTV.py (layout)
+ *       mythtv/bindings/python/MythTV/MythStatic.py (version number)
+ *       mythtv/bindings/python/MythTV/MythData.py (layout)
  */
-#define MYTH_PROTO_VERSION "56"
+#define MYTH_PROTO_VERSION "23056"
 
 MPUBLIC const char *GetMythSourceVersion();
 
diff -Naurp mythtv-0.23-release/libs/libmythdvdnav/dvdnav/dvdnav_internal.h mythtv-0.23/libs/libmythdvdnav/dvdnav/dvdnav_internal.h
--- mythtv-0.23-release/libs/libmythdvdnav/dvdnav/dvdnav_internal.h	2009-07-06 16:42:28.000000000 -0400
+++ mythtv-0.23/libs/libmythdvdnav/dvdnav/dvdnav_internal.h	2010-06-28 03:29:58.793477000 -0400
@@ -85,7 +85,7 @@ typedef struct read_cache_s read_cache_t
 
 #ifndef audio_status_t
 typedef struct {
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
   unsigned int available     : 1;
   unsigned int zero1         : 4;
   unsigned int stream_number : 3;
@@ -101,7 +101,7 @@ typedef struct {
 
 #ifndef spu_status_t
 typedef struct {
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
   unsigned int available               : 1;
   unsigned int zero1                   : 2;
   unsigned int stream_number_4_3       : 5;
diff -Naurp mythtv-0.23-release/libs/libmythdvdnav/dvdread/bswap.h mythtv-0.23/libs/libmythdvdnav/dvdread/bswap.h
--- mythtv-0.23-release/libs/libmythdvdnav/dvdread/bswap.h	2009-07-06 16:42:28.000000000 -0400
+++ mythtv-0.23/libs/libmythdvdnav/dvdread/bswap.h	2010-06-28 03:29:58.793477000 -0400
@@ -24,7 +24,7 @@
 
 #include <config.h>
 
-#if defined(WORDS_BIGENDIAN)
+#if HAVE_BIGENDIAN
 /* All bigendian systems are fine, just ignore the swaps. */
 #define B2N_16(x) (void)(x)
 #define B2N_32(x) (void)(x)
@@ -101,6 +101,6 @@
 
 #endif
 
-#endif /* WORDS_BIGENDIAN */
+#endif /* HAVE_BIGENDIAN */
 
 #endif /* LIBDVDREAD_BSWAP_H */
diff -Naurp mythtv-0.23-release/libs/libmythdvdnav/libmythdvdnav.pro mythtv-0.23/libs/libmythdvdnav/libmythdvdnav.pro
--- mythtv-0.23-release/libs/libmythdvdnav/libmythdvdnav.pro	2009-10-15 11:47:54.000000000 -0400
+++ mythtv-0.23/libs/libmythdvdnav/libmythdvdnav.pro	2010-05-11 11:07:54.320600000 -0400
@@ -13,6 +13,9 @@ INCLUDEPATH += ../libmythdb
 #build position independent code since the library is linked into a shared library
 QMAKE_CFLAGS += -fPIC -DPIC
 
+# for -ldl
+LIBS += $$EXTRA_LIBS
+
 DEFINES += HAVE_AV_CONFIG_H _LARGEFILE_SOURCE
 
 # DEFINES += LOG_DEBUG TRACE
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/AAFilter.cpp mythtv-0.23/libs/libmythsoundtouch/AAFilter.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/AAFilter.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/AAFilter.cpp	2009-04-10 20:04:30.069718000 -0400
@@ -12,7 +12,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: AAFilter.cpp 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/AAFilter.h mythtv-0.23/libs/libmythsoundtouch/AAFilter.h
--- mythtv-0.23-release/libs/libmythsoundtouch/AAFilter.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/AAFilter.h	2009-04-10 20:04:30.069718000 -0400
@@ -13,7 +13,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: AAFilter.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/BPMDetect.h mythtv-0.23/libs/libmythsoundtouch/BPMDetect.h
--- mythtv-0.23-release/libs/libmythsoundtouch/BPMDetect.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/BPMDetect.h	2009-04-10 20:04:30.069718000 -0400
@@ -26,7 +26,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: BPMDetect.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/cpu_detect.h mythtv-0.23/libs/libmythsoundtouch/cpu_detect.h
--- mythtv-0.23-release/libs/libmythsoundtouch/cpu_detect.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/cpu_detect.h	2009-04-10 20:04:30.069718000 -0400
@@ -12,7 +12,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: cpu_detect.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp mythtv-0.23/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp	2009-07-06 16:42:28.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp	2009-07-06 16:42:28.950839000 -0400
@@ -12,7 +12,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-07-06 13:42:28 -0700 (Mon, 06 Jul 2009) $
+// Last changed  : $Date: 2009-07-06 16:42:28 -0400 (Mon, 06 Jul 2009) $
 // File revision : $Revision: 20797 $
 //
 // $Id: cpu_detect_x86_gcc.cpp 20797 2009-07-06 20:42:28Z janne $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/FIFOSampleBuffer.cpp mythtv-0.23/libs/libmythsoundtouch/FIFOSampleBuffer.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/FIFOSampleBuffer.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/FIFOSampleBuffer.cpp	2009-04-10 20:04:30.069718000 -0400
@@ -15,7 +15,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: FIFOSampleBuffer.cpp 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/FIFOSampleBuffer.h mythtv-0.23/libs/libmythsoundtouch/FIFOSampleBuffer.h
--- mythtv-0.23-release/libs/libmythsoundtouch/FIFOSampleBuffer.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/FIFOSampleBuffer.h	2009-04-10 20:04:30.069718000 -0400
@@ -15,7 +15,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: FIFOSampleBuffer.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/FIFOSamplePipe.h mythtv-0.23/libs/libmythsoundtouch/FIFOSamplePipe.h
--- mythtv-0.23-release/libs/libmythsoundtouch/FIFOSamplePipe.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/FIFOSamplePipe.h	2009-04-10 20:04:30.069718000 -0400
@@ -17,7 +17,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: FIFOSamplePipe.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/FIRFilter.cpp mythtv-0.23/libs/libmythsoundtouch/FIRFilter.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/FIRFilter.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/FIRFilter.cpp	2009-04-10 20:04:30.069718000 -0400
@@ -11,7 +11,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: FIRFilter.cpp 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/FIRFilter.h mythtv-0.23/libs/libmythsoundtouch/FIRFilter.h
--- mythtv-0.23-release/libs/libmythsoundtouch/FIRFilter.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/FIRFilter.h	2009-04-10 20:04:30.069718000 -0400
@@ -11,7 +11,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: FIRFilter.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/mmx_gcc.cpp mythtv-0.23/libs/libmythsoundtouch/mmx_gcc.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/mmx_gcc.cpp	2009-07-06 16:42:28.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/mmx_gcc.cpp	2009-07-06 16:42:28.950839000 -0400
@@ -15,7 +15,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-07-06 13:42:28 -0700 (Mon, 06 Jul 2009) $
+// Last changed  : $Date: 2009-07-06 16:42:28 -0400 (Mon, 06 Jul 2009) $
 // File revision : $Revision: 20797 $
 //
 // $Id: mmx_gcc.cpp 20797 2009-07-06 20:42:28Z janne $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/RateTransposer.cpp mythtv-0.23/libs/libmythsoundtouch/RateTransposer.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/RateTransposer.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/RateTransposer.cpp	2009-04-10 20:04:30.069718000 -0400
@@ -10,7 +10,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: RateTransposer.cpp 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/RateTransposer.h mythtv-0.23/libs/libmythsoundtouch/RateTransposer.h
--- mythtv-0.23-release/libs/libmythsoundtouch/RateTransposer.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/RateTransposer.h	2009-04-10 20:04:30.069718000 -0400
@@ -14,7 +14,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: RateTransposer.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/SoundTouch.cpp mythtv-0.23/libs/libmythsoundtouch/SoundTouch.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/SoundTouch.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/SoundTouch.cpp	2009-04-10 20:04:30.069718000 -0400
@@ -41,7 +41,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: SoundTouch.cpp 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/SoundTouch.h mythtv-0.23/libs/libmythsoundtouch/SoundTouch.h
--- mythtv-0.23-release/libs/libmythsoundtouch/SoundTouch.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/SoundTouch.h	2009-04-10 20:04:30.069718000 -0400
@@ -41,7 +41,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: SoundTouch.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/STTypes.h mythtv-0.23/libs/libmythsoundtouch/STTypes.h
--- mythtv-0.23-release/libs/libmythsoundtouch/STTypes.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/STTypes.h	2009-04-10 20:04:30.069718000 -0400
@@ -8,7 +8,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: STTypes.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/TDStretch.cpp mythtv-0.23/libs/libmythsoundtouch/TDStretch.cpp
--- mythtv-0.23-release/libs/libmythsoundtouch/TDStretch.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/TDStretch.cpp	2009-04-10 20:04:30.069718000 -0400
@@ -13,7 +13,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: TDStretch.cpp 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythsoundtouch/TDStretch.h mythtv-0.23/libs/libmythsoundtouch/TDStretch.h
--- mythtv-0.23-release/libs/libmythsoundtouch/TDStretch.h	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythsoundtouch/TDStretch.h	2009-04-10 20:04:30.069718000 -0400
@@ -13,7 +13,7 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2009-04-10 17:04:30 -0700 (Fri, 10 Apr 2009) $
+// Last changed  : $Date: 2009-04-10 20:04:30 -0400 (Fri, 10 Apr 2009) $
 // File revision : $Revision: 20349 $
 //
 // $Id: TDStretch.h 20349 2009-04-11 00:04:30Z xris $
diff -Naurp mythtv-0.23-release/libs/libmythtv/avformatdecoder.cpp mythtv-0.23/libs/libmythtv/avformatdecoder.cpp
--- mythtv-0.23-release/libs/libmythtv/avformatdecoder.cpp	2010-04-29 20:08:03.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/avformatdecoder.cpp	2010-06-18 06:50:18.720005000 -0400
@@ -1291,6 +1291,14 @@ static float normalized_fps(AVStream *st
             fps = tmpfps;
     }
 
+    // and finally try the ffmpeg estimated rate
+    if (fps > 121.0f || fps < 3.0f)
+    {
+        float tmpfps = av_q2d(stream->r_frame_rate);
+        if (tmpfps > 20 && tmpfps < 70)
+            fps = tmpfps;
+    }
+
     // If it is still out of range, just assume NTSC...
     fps = (fps > 121.0f) ? (30000.0f / 1001.0f) : fps;
     return fps;
@@ -1386,11 +1394,10 @@ void AvFormatDecoder::InitVideoCodec(AVS
     {
         fps = normalized_fps(stream, enc);
 
-
-        if (stream->sample_aspect_ratio.num)
-            aspect_ratio = av_q2d(stream->sample_aspect_ratio);
-        else if (enc->sample_aspect_ratio.num)
+        if (enc->sample_aspect_ratio.num)
             aspect_ratio = av_q2d(enc->sample_aspect_ratio);
+        else if (stream->sample_aspect_ratio.num)
+            aspect_ratio = av_q2d(stream->sample_aspect_ratio);
         else
             aspect_ratio = 1.0f;
 
@@ -1418,6 +1425,8 @@ void AvFormatDecoder::InitVideoCodec(AVS
     enc->rate_emu = 0;
     enc->error_rate = 0;
 
+    directrendering = false;
+
     AVCodec *codec = avcodec_find_decoder(enc->codec_id);
     // look for a vdpau capable codec
     if (codec_is_vdpau(video_codec_id) && !CODEC_IS_VDPAU(codec))
@@ -1465,7 +1474,7 @@ void AvFormatDecoder::InitVideoCodec(AVS
     else if (codec && codec->capabilities & CODEC_CAP_DR1 &&
              (IS_DR1_PIX_FMT(enc->pix_fmt) /* HACK -- begin */
              /*   allow unknown pixel format to avoid regressions*/
-             || (enc->pix_fmt == PIX_FMT_NONE && ringBuffer->isDVD()))
+             ||  enc->pix_fmt == PIX_FMT_NONE)
 	     /* HACK -- end*/)
     {
         enc->flags          |= CODEC_FLAG_EMU_EDGE;
@@ -2402,6 +2411,13 @@ int get_avf_buffer(struct AVCodecContext
 {
     AvFormatDecoder *nd = (AvFormatDecoder *)(c->opaque);
 
+    if (!IS_DR1_PIX_FMT(c->pix_fmt))
+    {
+        nd->directrendering = false;
+        return avcodec_default_get_buffer(c, pic);
+    }
+    nd->directrendering = true;
+
     VideoFrame *frame = nd->GetNVP()->GetNextVideoFrame(true);
 
     for (int i = 0; i < 3; i++)
@@ -4361,6 +4377,12 @@ bool AvFormatDecoder::GetFrame(DecodeTyp
                             GetNVP()->DiscardVideoFrame(xf);
                         }
                     }
+                    else if (!picframe)
+                    {
+                        VERBOSE(VB_IMPORTANT, LOC_ERR + "NULL videoframe - "
+                                "direct rendering not correctly initialized.");
+                        return false;
+                    }
 
                     long long temppts = pts;
 
@@ -4617,6 +4639,7 @@ bool AvFormatDecoder::DoPassThrough(cons
     else if (ctx->codec_id == CODEC_ID_DTS)
         passthru = allow_dts_passthru && !internal_vol;
 
+    passthru &= GetNVP()->CanPassthrough();
     passthru &= !transcoding && !disable_passthru;
     // Don't know any cards that support spdif clocked at < 44100
     // Some US cable transmissions have 2ch 32k AC-3 streams
diff -Naurp mythtv-0.23-release/libs/libmythtv/dbcheck.cpp mythtv-0.23/libs/libmythtv/dbcheck.cpp
--- mythtv-0.23-release/libs/libmythtv/dbcheck.cpp	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/dbcheck.cpp	2010-05-23 19:30:49.920201000 -0400
@@ -476,13 +476,8 @@ bool UpgradeTVDatabaseSchema(const bool 
         return true;
     }
 
-    // An upgrade is likely. We do the backup first so that
-    // the UI can tell the user where the backup is located.
-    if (upgradeAllowed)
-        DBup->BackupDB();
-    else
-        VERBOSE(VB_IMPORTANT, "Not allowed to upgrade the database. "
-                              "Skipping backup.");
+    if (!upgradeAllowed)
+        VERBOSE(VB_IMPORTANT, "Not allowed to upgrade the database.");
 
     // Pop up messages, questions, warnings, et c.
     switch (DBup->PromptForUpgrade("TV", upgradeAllowed,
diff -Naurp mythtv-0.23-release/libs/libmythtv/firewiredevice.cpp mythtv-0.23/libs/libmythtv/firewiredevice.cpp
--- mythtv-0.23-release/libs/libmythtv/firewiredevice.cpp	2010-03-02 16:07:25.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/firewiredevice.cpp	2010-07-09 16:15:15.198128000 -0400
@@ -329,7 +329,7 @@ void FirewireDevice::SetLastChannel(cons
 
 void FirewireDevice::ProcessPATPacket(const TSPacket &tspacket)
 {
-    if (!tspacket.TransportError() && !tspacket.ScramplingControl() &&
+    if (!tspacket.TransportError() && !tspacket.Scrambled() &&
         tspacket.HasPayload() && tspacket.PayloadStart() && !tspacket.PID())
     {
         PESPacket pes = PESPacket::View(tspacket);
diff -Naurp mythtv-0.23-release/libs/libmythtv/firewirerecorder.cpp mythtv-0.23/libs/libmythtv/firewirerecorder.cpp
--- mythtv-0.23-release/libs/libmythtv/firewirerecorder.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/firewirerecorder.cpp	2010-07-09 16:15:15.198128000 -0400
@@ -128,7 +128,7 @@ void FirewireRecorder::ProcessTSPacket(c
     if (tspacket.TransportError())
         return;
 
-    if (tspacket.ScramplingControl())
+    if (tspacket.Scrambled())
         return;
 
     if (tspacket.HasAdaptationField())
diff -Naurp mythtv-0.23-release/libs/libmythtv/iptvrecorder.cpp mythtv-0.23/libs/libmythtv/iptvrecorder.cpp
--- mythtv-0.23-release/libs/libmythtv/iptvrecorder.cpp	2010-04-05 10:44:05.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/iptvrecorder.cpp	2010-07-09 16:15:15.198128000 -0400
@@ -211,7 +211,7 @@ void IPTVRecorder::ProcessTSPacket(const
     if (!_stream_data)
         return;
 
-    if (tspacket.TransportError() || tspacket.ScramplingControl())
+    if (tspacket.TransportError() || tspacket.Scrambled())
         return;
 
     if (tspacket.HasAdaptationField())
diff -Naurp mythtv-0.23-release/libs/libmythtv/jobqueue.h mythtv-0.23/libs/libmythtv/jobqueue.h
--- mythtv-0.23-release/libs/libmythtv/jobqueue.h	2010-01-31 22:49:37.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/jobqueue.h	2010-06-17 12:33:12.060417000 -0400
@@ -2,6 +2,7 @@
 #define JOBQUEUE_H_
 
 #include <pthread.h>
+#include <sys/types.h>
 
 #include <QWaitCondition>
 #include <QObject>
diff -Naurp mythtv-0.23-release/libs/libmythtv/mpeg/mpegstreamdata.cpp mythtv-0.23/libs/libmythtv/mpeg/mpegstreamdata.cpp
--- mythtv-0.23-release/libs/libmythtv/mpeg/mpegstreamdata.cpp	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/mpeg/mpegstreamdata.cpp	2010-07-09 16:15:15.198128000 -0400
@@ -891,7 +891,7 @@ void MPEGStreamData::HandleTSTables(cons
     if (!psip->IsCurrent()) // we don't cache the next table, for now
         DONE_WITH_PES_PACKET();
 
-    if (tspacket->ScramplingControl())
+    if (tspacket->Scrambled())
     { // scrambled! ATSC, DVB require tables not to be scrambled
         VERBOSE(VB_RECORD,
                 "PSIP packet is scrambled, not ATSC/DVB compiant");
@@ -975,7 +975,7 @@ bool MPEGStreamData::ProcessTSPacket(con
     if (!ok)
         return false;
 
-    if (!tspacket.ScramplingControl() && tspacket.HasPayload())
+    if (!tspacket.Scrambled() && tspacket.HasPayload())
     {
         if (IsVideoPID(tspacket.PID()))
         {
@@ -1004,7 +1004,7 @@ bool MPEGStreamData::ProcessTSPacket(con
             HandleTSTables(&tspacket);
         }
     }
-    else if (!tspacket.ScramplingControl() && IsWritingPID(tspacket.PID()))
+    else if (!tspacket.Scrambled() && IsWritingPID(tspacket.PID()))
     {
         // PCRPID and other streams we're writing may not have payload...
         for (uint j = 0; j < _ts_writing_listeners.size(); j++)
@@ -1728,7 +1728,7 @@ void MPEGStreamData::ProcessEncryptedPac
 
     CryptStatus status = kEncUnknown;
 
-    if (tspacket.ScramplingControl())
+    if (tspacket.Scrambled())
     {
         info.decrypted_packets = 0;
 
diff -Naurp mythtv-0.23-release/libs/libmythtv/mpeg/tspacket.cpp mythtv-0.23/libs/libmythtv/mpeg/tspacket.cpp
--- mythtv-0.23-release/libs/libmythtv/mpeg/tspacket.cpp	2009-04-10 20:04:30.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/mpeg/tspacket.cpp	2010-07-09 16:15:15.198128000 -0400
@@ -39,7 +39,7 @@ QString TSPacket::toString() const {
     str.append("           payloadStart: %1\n").arg( PayloadStart() );
     str.append("               priority: %1\n").arg( Priority() );
     str.append("                    pid: %1\n").arg( PID() );
-    str.append("              scrampled: %1\n").arg( ScramplingControl() );
+    str.append("       scrambled (if>1): %1\n").arg( ScramblingControl() );
     str.append(" adaptationFieldControl: %1\n").arg( AdaptationFieldControl() );
     str.append("      continuityCounter: %1\n").arg( ContinuityCounter() );
     return str;
diff -Naurp mythtv-0.23-release/libs/libmythtv/mpeg/tspacket.h mythtv-0.23/libs/libmythtv/mpeg/tspacket.h
--- mythtv-0.23-release/libs/libmythtv/mpeg/tspacket.h	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/mpeg/tspacket.h	2010-07-09 16:15:15.198128000 -0400
@@ -67,7 +67,7 @@ class TSHeader {
         return ((_tsdata[1] << 8) + _tsdata[2]) & 0x1fff;
     }
     //3.0  2 bit transport_scrambling_control (00,01 OK; 10,11 scrambled)
-    unsigned int ScramplingControl() const { return (_tsdata[3] >> 6) & 0x3; }
+    unsigned int ScramblingControl() const { return (_tsdata[3] >> 6) & 0x3; }
     //3.2  2 bit adaptation_field_control
     //       (01-no adaptation field,payload only
     //        10-adaptation field only,no payload
@@ -82,7 +82,7 @@ class TSHeader {
     unsigned int ContinuityCounter() const { return _tsdata[3] & 0xf; }
 
     // shortcuts
-    bool Scrampled() const { return bool(_tsdata[3]&0x80); }
+    bool Scrambled() const { return bool(_tsdata[3]&0x80); }
     bool HasAdaptationField() const { return bool(_tsdata[3] & 0x20); }
     bool HasPayload() const { return bool(_tsdata[3] & 0x10); }
 
diff -Naurp mythtv-0.23-release/libs/libmythtv/nuppeldecoder.cpp mythtv-0.23/libs/libmythtv/nuppeldecoder.cpp
--- mythtv-0.23-release/libs/libmythtv/nuppeldecoder.cpp	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/nuppeldecoder.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -27,7 +27,7 @@ using namespace std;
 
 #include "minilzo.h"
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
 extern "C" {
 #include "bswap.h"
 }
@@ -41,7 +41,7 @@ NuppelDecoder::NuppelDecoder(NuppelVideo
     : DecoderBase(parent, pginfo),
       rtjd(0), video_width(0), video_height(0), video_size(0),
       video_frame_rate(0.0f), audio_samplerate(44100),
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
       audio_bits_per_sample(0),
 #endif
       ffmpeg_extradatasize(0), ffmpeg_extradata(0), usingextradata(false),
@@ -139,7 +139,7 @@ bool NuppelDecoder::ReadFileheader(struc
     if (ringBuffer->Read(fh, FILEHEADERSIZE) != FILEHEADERSIZE)
         return false;
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     fh->width         = bswap_32(fh->width);
     fh->height        = bswap_32(fh->height);
     fh->desiredwidth  = bswap_32(fh->desiredwidth);
@@ -160,7 +160,7 @@ bool NuppelDecoder::ReadFrameheader(stru
     if (ringBuffer->Read(fh, FRAMEHEADERSIZE) != FRAMEHEADERSIZE)
         return false;
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     fh->timecode     = bswap_32(fh->timecode);
     fh->packetlength = bswap_32(fh->packetlength);
 #endif
@@ -287,7 +287,7 @@ int NuppelDecoder::OpenFile(RingBuffer *
         else
         {
             ringBuffer->Read(&extradata, frameheader.packetlength);
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
             struct extendeddata *ed = &extradata;
             ed->version                 = bswap_32(ed->version);
             ed->video_fourcc            = bswap_32(ed->video_fourcc);
@@ -353,7 +353,7 @@ int NuppelDecoder::OpenFile(RingBuffer *
                 {
                     memcpy(&ste, seekbuf + offset,
                            sizeof(struct seektable_entry));
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
                     ste.file_offset     = bswap_64(ste.file_offset);
                     ste.keyframe_number = bswap_32(ste.keyframe_number);
 #endif
@@ -422,7 +422,7 @@ int NuppelDecoder::OpenFile(RingBuffer *
                 {
                     memcpy(&kfate, kfa_buf + offset,
                            sizeof(struct kfatable_entry));
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
                     kfate.adjust          = bswap_32(kfate.adjust);
                     kfate.keyframe_number = bswap_32(kfate.keyframe_number);
 #endif
@@ -495,7 +495,7 @@ int NuppelDecoder::OpenFile(RingBuffer *
         effdsp = extradata.audio_sample_rate * 100;
         GetNVP()->SetEffDsp(effdsp);
         audio_samplerate = extradata.audio_sample_rate;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
         // Why only if using extradata?
         audio_bits_per_sample = extradata.audio_bits_per_sample;
 #endif
@@ -1242,7 +1242,7 @@ bool NuppelDecoder::GetFrame(DecodeType 
             else
             {
                 getrawframes = 0;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
                 // Why endian correct the audio buffer here?
                 // Don't big-endian clients have to do it in audiooutBlah.cpp?
                 if (audio_bits_per_sample == 16) {
@@ -1290,7 +1290,7 @@ bool NuppelDecoder::GetFrame(DecodeType 
 
             if (QString(fh->finfo) == "MythTVVideo")
             {
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
                 fh->width         = bswap_32(fh->width);
                 fh->height        = bswap_32(fh->height);
                 fh->desiredwidth  = bswap_32(fh->desiredwidth);
diff -Naurp mythtv-0.23-release/libs/libmythtv/nuppeldecoder.h mythtv-0.23/libs/libmythtv/nuppeldecoder.h
--- mythtv-0.23-release/libs/libmythtv/nuppeldecoder.h	2010-01-18 13:15:35.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/nuppeldecoder.h	2010-06-28 03:29:58.793477000 -0400
@@ -1,6 +1,8 @@
 #ifndef NUPPELDECODER_H_
 #define NUPPELDECODER_H_
 
+#include "config.h"
+
 #include <list>
 using namespace std;
 
@@ -81,7 +83,7 @@ class NuppelDecoder : public DecoderBase
     int video_width, video_height, video_size;
     double video_frame_rate;
     int audio_samplerate;
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     int audio_bits_per_sample;
 #endif
 
diff -Naurp mythtv-0.23-release/libs/libmythtv/NuppelVideoPlayer.cpp mythtv-0.23/libs/libmythtv/NuppelVideoPlayer.cpp
--- mythtv-0.23-release/libs/libmythtv/NuppelVideoPlayer.cpp	2010-04-27 22:54:52.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/NuppelVideoPlayer.cpp	2010-07-08 08:40:46.381707000 -0400
@@ -1182,7 +1182,7 @@ int NuppelVideoPlayer::OpenFile(bool ski
     }
 
     player_ctx->buffer->Start();
-    char testbuf[kDecoderProbeBufferSize];
+    char *testbuf = new char[kDecoderProbeBufferSize];
     player_ctx->buffer->Unpause(); // so we can read testbuf if we were paused
 
     // delete any pre-existing recorder
@@ -1196,6 +1196,7 @@ int NuppelVideoPlayer::OpenFile(bool ski
             VERBOSE(VB_IMPORTANT,
                     QString("NVP::OpenFile(): Error, couldn't read file: %1")
                     .arg(player_ctx->buffer->GetFilename()));
+            delete [] testbuf;
             return -1;
         }
 
@@ -1222,13 +1223,14 @@ int NuppelVideoPlayer::OpenFile(bool ski
         VERBOSE(VB_IMPORTANT, LOC_ERR +
                 QString("Couldn't find an A/V decoder for: '%1'")
                 .arg(player_ctx->buffer->GetFilename()));
-
+        delete [] testbuf;
         return -1;
     }
     else if (GetDecoder()->IsErrored())
     {
         VERBOSE(VB_IMPORTANT, LOC_ERR + "Could not initialize A/V decoder.");
         SetDecoder(NULL);
+        delete [] testbuf;
         return -1;
     }
 
@@ -1252,6 +1254,7 @@ int NuppelVideoPlayer::OpenFile(bool ski
     {
         VERBOSE(VB_IMPORTANT, QString("Couldn't open decoder for: %1")
                 .arg(player_ctx->buffer->GetFilename()));
+        delete [] testbuf;
         return -1;
     }
 
@@ -1276,6 +1279,8 @@ int NuppelVideoPlayer::OpenFile(bool ski
 
     bookmarkseek = GetBookmark();
 
+    delete [] testbuf;
+
     return IsErrored() ? -1 : 0;
 }
 
@@ -5134,6 +5139,13 @@ bool NuppelVideoPlayer::ToggleUpmix()
     return false;
 }
 
+bool NuppelVideoPlayer::CanPassthrough()
+{
+    if (audioOutput)
+        return audioOutput->CanPassthrough();
+    return false;
+}
+
 void NuppelVideoPlayer::Zoom(ZoomDirection direction)
 {
     if (videoOutput)
diff -Naurp mythtv-0.23-release/libs/libmythtv/NuppelVideoPlayer.h mythtv-0.23/libs/libmythtv/NuppelVideoPlayer.h
--- mythtv-0.23-release/libs/libmythtv/NuppelVideoPlayer.h	2010-03-08 19:33:51.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/NuppelVideoPlayer.h	2010-06-18 06:50:18.720005000 -0400
@@ -165,6 +165,7 @@ class MPUBLIC NuppelVideoPlayer : public
     void ToggleAspectOverride(AspectOverrideMode aspectMode = kAspect_Toggle);
     void ToggleAdjustFill(AdjustFillMode adjustfillMode = kAdjustFill_Toggle);
     bool ToggleUpmix(void);
+    bool CanPassthrough(void);
 
     // Gets
     QSize   GetVideoBufferSize(void) const    { return video_dim; }
diff -Naurp mythtv-0.23-release/libs/libmythtv/NuppelVideoRecorder.cpp mythtv-0.23/libs/libmythtv/NuppelVideoRecorder.cpp
--- mythtv-0.23-release/libs/libmythtv/NuppelVideoRecorder.cpp	2010-04-14 18:00:50.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/NuppelVideoRecorder.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -33,7 +33,7 @@ using namespace std;
 #include "audioinput.h"
 #include "myth_imgconvert.h"
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
 extern "C" {
 #include "bswap.h"
 }
@@ -1873,7 +1873,7 @@ void NuppelVideoRecorder::BufferIt(unsig
 
 inline void NuppelVideoRecorder::WriteFrameheader(rtframeheader *fh)
 {
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     fh->timecode     = bswap_32(fh->timecode);
     fh->packetlength = bswap_32(fh->packetlength);
 #endif
@@ -1921,7 +1921,7 @@ void NuppelVideoRecorder::WriteFileHeade
     fileheader.textsblocks = -1; // TODO: make only -1 if VBI support active?
     fileheader.keyframedist = KEYFRAMEDIST;
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     fileheader.width         = bswap_32(fileheader.width);
     fileheader.height        = bswap_32(fileheader.height);
     fileheader.desiredwidth  = bswap_32(fileheader.desiredwidth);
@@ -2030,7 +2030,7 @@ void NuppelVideoRecorder::WriteHeader(vo
 
     extendeddataOffset = ringBuffer->GetWritePosition();
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
     moredata.version                 = bswap_32(moredata.version);
     moredata.video_fourcc            = bswap_32(moredata.video_fourcc);
     moredata.audio_fourcc            = bswap_32(moredata.audio_fourcc);
@@ -3147,7 +3147,7 @@ void NuppelVideoRecorder::WriteVideo(Vid
     lf = fnum;
 }
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
 static void bswap_16_buf(short int *buf, int buf_cnt, int audio_channels)
     __attribute__ ((unused)); /* <- suppress compiler warning */
 
@@ -3214,7 +3214,7 @@ void NuppelVideoRecorder::WriteAudio(uns
 
         int sample_cnt = audio_buffer_size / audio_bytes_per_sample;
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
         bswap_16_buf((short int*) buf, sample_cnt, audio_channels);
 #endif
 
diff -Naurp mythtv-0.23-release/libs/libmythtv/RTjpegN.h mythtv-0.23/libs/libmythtv/RTjpegN.h
--- mythtv-0.23-release/libs/libmythtv/RTjpegN.h	2009-07-06 16:42:28.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/RTjpegN.h	2010-06-28 03:29:58.793477000 -0400
@@ -33,7 +33,7 @@ Foundation, Inc., 59 Temple Place, Suite
 #define RTJPEG_FILE_VERSION 0
 #define RTJPEG_HEADER_SIZE 12
 
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
 #define RTJPEG_SWAP_WORD(a) ( ((a) << 24) | \
 			(((a) << 8) & 0x00ff0000) | \
 			(((a) >> 8) & 0x0000ff00) | \
diff -Naurp mythtv-0.23-release/libs/libmythtv/tv_play.cpp mythtv-0.23/libs/libmythtv/tv_play.cpp
--- mythtv-0.23-release/libs/libmythtv/tv_play.cpp	2010-04-27 22:54:52.000000000 -0400
+++ mythtv-0.23/libs/libmythtv/tv_play.cpp	2010-05-17 21:42:52.462765000 -0400
@@ -4617,9 +4617,9 @@ bool TV::ActivePostQHandleAction(PlayerC
     else if (has_action("NEXTFAV", actions) && islivetv)
         ChangeChannel(ctx, CHANNEL_DIRECTION_FAVORITE);
     else if (has_action("NEXTSOURCE", actions) && islivetv)
-        SwitchSource(kNextSource);
+        SwitchSource(ctx, kNextSource);
     else if (has_action("PREVSOURCE", actions) && islivetv)
-        SwitchSource(kPreviousSource);
+        SwitchSource(ctx, kPreviousSource);
     else if (has_action("NEXTINPUT", actions) && islivetv)
         ToggleInputs(ctx);
     else if (has_action("NEXTCARD", actions) && islivetv)
@@ -6315,17 +6315,11 @@ void TV::DoSkipCommercials(PlayerContext
         SetMuteTimer(ctx, kMuteTimeout);
 }
 
-void TV::SwitchSource(uint source_direction)
+void TV::SwitchSource(PlayerContext *ctx, uint source_direction)
 {
-    PlayerContext *actx = GetPlayerReadLock(-1, __FILE__, __LINE__);
-    if (!actx->recorder)
-    {
-        ReturnPlayerLock(actx);
-        return;
-    }
     QMap<uint,InputInfo> sources;
     vector<uint> cardids = RemoteRequestFreeRecorderList();
-    uint         cardid  = actx->GetCardID();
+    uint         cardid  = ctx->GetCardID();
     cardids.push_back(cardid);
     stable_sort(cardids.begin(), cardids.end());
 
@@ -6333,7 +6327,7 @@ void TV::SwitchSource(uint source_direct
     excluded_cardids.push_back(cardid);
 
     InfoMap info;
-    actx->recorder->GetChannelInfo(info);
+    ctx->recorder->GetChannelInfo(info);
     uint sourceid = info["sourceid"].toUInt();
 
     vector<uint>::const_iterator it = cardids.begin();
@@ -6363,7 +6357,6 @@ void TV::SwitchSource(uint source_direct
 
     if (sit == sources.end())
     {
-        ReturnPlayerLock(actx);
         return;
     }
 
@@ -6391,12 +6384,10 @@ void TV::SwitchSource(uint source_direct
 
     if (sit == beg)
     {
-        ReturnPlayerLock(actx);
         return;
     }
 
     switchToInputId = (*sit).inputid;
-    ReturnPlayerLock(actx);
 
     QMutexLocker locker(&timerIdLock);
     if (!switchToInputTimerId)
diff -Naurp mythtv-0.23-release/libs/libmythtv/tv_play.h mythtv-0.23/libs/libmythtv/tv_play.h
--- mythtv-0.23-release/libs/libmythtv/tv_play.h	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/tv_play.h	2010-05-17 21:42:52.462765000 -0400
@@ -402,7 +402,7 @@ class MPUBLIC TV : public QThread
     QString GetQueuedChanNum(void) const;
     uint    GetQueuedChanID(void)  const { return queuedChanID; }
 
-    void SwitchSource(uint source_direction);
+    void SwitchSource(PlayerContext*, uint source_direction);
     void SwitchInputs(PlayerContext*, uint inputid);
     void ToggleInputs(PlayerContext*, uint inputid = 0);
     void SwitchCards(PlayerContext*,
diff -Naurp mythtv-0.23-release/libs/libmythtv/videooutbase.h mythtv-0.23/libs/libmythtv/videooutbase.h
--- mythtv-0.23-release/libs/libmythtv/videooutbase.h	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/videooutbase.h	2010-07-08 23:39:18.186345000 -0400
@@ -84,8 +84,8 @@ class VideoOutput
     virtual void ResizeDisplayWindow(const QRect&, bool);
     virtual void EmbedInWidget(int x, int y, int w, int h);
     virtual void StopEmbedding(void);
-    void         ResizeForGui(void);
-    void         ResizeForVideo(uint width = 0, uint height = 0);
+    virtual void ResizeForGui(void);
+    virtual void ResizeForVideo(uint width = 0, uint height = 0);
     virtual void MoveResizeWindow(QRect new_rect) = 0;
 
     virtual void MoveResize(void);
@@ -110,7 +110,7 @@ class VideoOutput
     /// \brief Returns current aspect override mode
     /// \sa ToggleAspectOverride(AspectOverrideMode)
     AspectOverrideMode GetAspectOverride(void) const;
-    void ToggleAspectOverride(
+    virtual void ToggleAspectOverride(
         AspectOverrideMode aspectOverrideMode = kAspect_Toggle);
 
     /// \brief Returns current adjust fill mode
diff -Naurp mythtv-0.23-release/libs/libmythtv/videoout_d3d.cpp mythtv-0.23/libs/libmythtv/videoout_d3d.cpp
--- mythtv-0.23-release/libs/libmythtv/videoout_d3d.cpp	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/videoout_d3d.cpp	2010-06-19 01:57:23.850116000 -0400
@@ -1252,13 +1252,13 @@ void VideoOutputD3D::Show(FrameScanType 
     SetThreadExecutionState(ES_SYSTEM_REQUIRED | ES_DISPLAY_REQUIRED);
 }
 
-void VideoOutputD3D::EmbedInWidget(WId wid, int x, int y, int w, int h)
+void VideoOutputD3D::EmbedInWidget(int x, int y, int w, int h)
 {
     if (windows[0].IsEmbedding())
         return;
 
     VideoOutput::EmbedInWidget(x, y, w, h);
-    m_hEmbedWnd = wid;
+    // TODO: Initialise m_hEmbedWnd?
 }
 
 void VideoOutputD3D::StopEmbedding(void)
diff -Naurp mythtv-0.23-release/libs/libmythtv/videoout_d3d.h mythtv-0.23/libs/libmythtv/videoout_d3d.h
--- mythtv-0.23-release/libs/libmythtv/videoout_d3d.h	2010-02-03 10:39:11.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/videoout_d3d.h	2010-06-18 03:11:40.067331000 -0400
@@ -115,7 +115,7 @@ class VideoOutputD3D : public VideoOutpu
     void UpdatePauseFrame(void);
     void DrawUnusedRects(bool) {;}
     void Zoom(ZoomDirection direction);
-    void EmbedInWidget(WId wid, int x, int y, int w, int h);
+    void EmbedInWidget(int x, int y, int w, int h);
     void StopEmbedding(void);
     bool hasFullScreenOSD(void) const { return m_d3d_osd; }
     static QStringList GetAllowedRenderers(MythCodecID myth_codec_id,
diff -Naurp mythtv-0.23-release/libs/libmythtv/videoout_quartz.cpp mythtv-0.23/libs/libmythtv/videoout_quartz.cpp
--- mythtv-0.23-release/libs/libmythtv/videoout_quartz.cpp	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/videoout_quartz.cpp	2010-07-13 15:02:05.716954000 -0400
@@ -18,7 +18,7 @@
  *   on any screen except, you guessed it, the main screen.
  *
  * = REVISION
- * $Id: videoout_quartz.cpp 23669 2010-03-07 03:11:52Z jpoet $
+ * $Id: videoout_quartz.cpp 25333 2010-07-13 19:02:05Z nigel $
  *
  * = AUTHORS
  * Nigel Pearson, Jeremiah Morris
@@ -89,7 +89,8 @@ class VideoOutputQuartzView
                               MythCodecID av_codec_id);
     virtual void MoveResize(QRect newRect);
 
-    virtual void EmbedChanged(bool embedded);
+    virtual void HideForGUI(void);
+    virtual void ShowAfterGUI(QRect size);
 
   protected:
     virtual bool Begin(void);
@@ -478,12 +479,18 @@ void VideoOutputQuartzView::MoveResize(Q
         Transform(newRect);
 }
 
-/// Subclasses that block the main window should suspend
-/// playback, hide windows, etc by overriding this method.
-void VideoOutputQuartzView::EmbedChanged(bool embedded)
+/// Subclasses that block the main window should hide
+/// their output so that the GUI behind is fully visible.
+void VideoOutputQuartzView::HideForGUI(void)
+{
+    // do nothing in default version
+}
+
+/// Subclasses that block the main window should re-enable their
+/// output after the user has finished interacing with the GUI.
+void VideoOutputQuartzView::ShowAfterGUI(QRect size)
 {
     // do nothing in default version
-    (void)embedded;
 }
 
 /**
@@ -497,7 +504,7 @@ class VoqvMainWindow : public VideoOutpu
     {
         alpha = fminf(1.0, fmaxf(0.0, alphaBlend));
         applyMoveResize = true;
-        name = "Main window: ";
+        name = (char *) "Main window: ";
     };
 
    ~VoqvMainWindow()
@@ -551,20 +558,18 @@ class VoqvMainWindow : public VideoOutpu
         viewLock.unlock();
     };
 
-    // On embedding, we stop video playback.
-    void EmbedChanged(bool embedded)
+    void HideForGUI(void)
     {
-        if (embedded)
-        {
-            End();
-            EndPort();
-        }
-        else
-        {
-            BeginPort();
-            Begin();
-        }
-    };
+        VERBOSE(VB_PLAYBACK, "VOQV::HideForGUI() main window");
+        End();
+    }
+
+    void ShowAfterGUI(QRect size)
+    {
+        VERBOSE(VB_PLAYBACK, "VOQV::ShowAfterGUI() main window");
+        Begin();
+        Transform(size);
+    }
 };
 
 /**
@@ -577,7 +582,7 @@ class VoqvEmbedded : public VideoOutputQ
     : VideoOutputQuartzView(pData)
     {
         m_desired = QRect(x, y, w, h);
-        name = "Embedded window: ";
+        name = (char *) "Embedded window: ";
     };
 
    ~VoqvEmbedded()
@@ -604,11 +609,42 @@ class VoqvEmbedded : public VideoOutputQ
         GetPortBounds(thePort, &portBounds);
         InvalWindowRect(parentData->window, &portBounds);
 
-        // The main class handles masking and resizing, since we set m_desired
         viewLock.unlock();
         return true;
     };
 
+    // Simple scaler setup that just uses m_desired to fill embed area:
+    bool Begin(void)
+    {
+        viewLock.lock();
+        if (DecompressSequenceBeginS(&theCodec, parentData->imgDesc,
+                                     NULL, 0, thePort, NULL, NULL, NULL,
+                                     srcCopy, theMask, 0,
+                                     codecNormalQuality, bestSpeedCodec))
+        {
+            VERBOSE(VB_IMPORTANT,
+                    QString("VOQV::Begin(%1) - DecompressSequenceBeginS failed")
+                    .arg(name));
+            viewLock.unlock();
+            return false;
+        }
+
+        // Turn off gamma correction unless requested
+        if (!parentData->correctGamma)
+            QTSetPixMapHandleRequestedGammaLevel(GetPortPixMap(thePort),
+                                                 kQTUseSourceGammaLevel);
+
+        SetDSequenceFlags(theCodec,
+                          codecDSequenceFlushInsteadOfDirtying,
+                          codecDSequenceFlushInsteadOfDirtying);
+        viewLock.unlock();
+
+        // set transformation matrix
+        Transform(m_desired);
+
+        return true;
+    }
+
     void EndPort(void)
     {
         viewLock.lock();
@@ -627,7 +663,7 @@ class VoqvFullscreen : public VideoOutpu
     : VideoOutputQuartzView(pData)
     {
         applyMoveResize = true;
-        name = "Full screen: ";
+        name = (char *) "Full screen: ";
     };
 
    ~VoqvFullscreen()
@@ -696,21 +732,20 @@ class VoqvFullscreen : public VideoOutpu
         viewLock.unlock();
     };
 
-    // On embedding, we release the display, and
-    // restore everything when we're through.
-    void EmbedChanged(bool embedded)
+    void HideForGUI(void)
     {
-        if (embedded)
-        {
-            End();
-            EndPort();
-        }
-        else
-        {
-            BeginPort();
-            Begin();
-        }
-    };
+        VERBOSE(VB_PLAYBACK, "VOQV::HideForGUI() full screen");
+        End();
+        EndPort();
+    }
+
+    void ShowAfterGUI(QRect size)
+    {
+        VERBOSE(VB_PLAYBACK, "VOQV::ShowAfterGUI() full screen");
+        BeginPort();
+        Begin();
+        Transform(size);
+    }
 };
 
 /**
@@ -722,7 +757,7 @@ class VoqvDock : public VideoOutputQuart
     VoqvDock(QuartzData *pData)
     : VideoOutputQuartzView(pData)
     {
-        name = "Dock icon: ";
+        name = (char *) "Dock icon: ";
     };
 
    ~VoqvDock()
@@ -766,7 +801,7 @@ class VoqvFloater : public VideoOutputQu
     {
         alpha = fminf(1.0, fmaxf(0.0, alphaBlend));
         resizing = false;
-        name = "Floating window: ";
+        name = (char *) "Floating window: ";
     };
 
    ~VoqvFloater()
@@ -904,21 +939,6 @@ class VoqvFloater : public VideoOutputQu
         UnregisterToolboxObjectClass(myClass);
         viewLock.unlock();
     };
-
-    // We hide the window during embedding.
-    void EmbedChanged(bool embedded)
-    {
-        if (embedded)
-        {
-            End();
-            HideWindow(window);
-        }
-        else
-        {
-            ShowWindow(window);
-            Begin();
-        }
-    };
 };
 
 // The event callback for the floating window above
@@ -1004,7 +1024,7 @@ class VoqvDesktop : public VideoOutputQu
     VoqvDesktop(QuartzData *pData)
     : VideoOutputQuartzView(pData)
     {
-        name = "Desktop: ";
+        name = (char *) "Desktop: ";
     };
 
    ~VoqvDesktop()
@@ -1173,6 +1193,12 @@ void VideoOutputQuartz::MoveResize(void)
     }
 }
 
+void VideoOutputQuartz::ToggleAspectOverride(AspectOverrideMode aspectMode)
+{
+    VideoOutput::ToggleAspectOverride(aspectMode);
+    MoveResize();
+}
+
 bool VideoOutputQuartz::InputChanged(const QSize &input_size,
                                      float        aspect,
                                      MythCodecID  av_codec_id,
@@ -1598,25 +1624,27 @@ void VideoOutputQuartz::DeleteQuartzBuff
     vbuffers.DeleteBuffers();
 }
 
-void VideoOutputQuartz::EmbedInWidget(WId wid, int x, int y, int w, int h)
+void VideoOutputQuartz::EmbedInWidget(int x, int y, int w, int h)
 {
-    VERBOSE(VB_PLAYBACK,
-            (LOC + "EmbedInWidget(wid=%1, x=%2, y=%3, w=%4, h=%5)")
-            .arg(wid).arg(x).arg(y).arg(w).arg(h));
+    VERBOSE(VB_PLAYBACK, (LOC + "EmbedInWidget(x=%1, y=%2, w=%3, h=%4)")
+                         .arg(x).arg(y).arg(w).arg(h));
 
     if (windows[0].IsEmbedding())
         return;
 
     VideoOutput::EmbedInWidget(x, y, w, h);
+    // Base class has now calculated Aspect/Fill,
+    // so copy for precision sizing of new widget:
+    QRect newArea = windows[0].GetDisplayVideoRect();
 
-    data->pixelLock.lock();
+    x = newArea.left(), y = newArea.top(),
+    w = newArea.width(), h = newArea.height();
 
-    // warn other views that embedding is starting
-    vector<VideoOutputQuartzView*>::iterator it = data->views.begin();
-    for (; it != data->views.end(); ++it)
-    {
-        (*it)->EmbedChanged(true);
-    }
+    VERBOSE(VB_PLAYBACK, (LOC + "EmbedInWidget() - now x=%1, y=%2, w=%3, h=%4")
+                         .arg(x).arg(y).arg(w).arg(h));
+
+
+    data->pixelLock.lock();
 
     // create embedded widget
     data->embeddedView = new VoqvEmbedded(data, x, y, w, h);
@@ -1653,11 +1681,6 @@ void VideoOutputQuartz::StopEmbedding(vo
         data->embeddedView = NULL;
     }
 
-    // tell other views to return to normal
-    vector<VideoOutputQuartzView*>::iterator it = data->views.begin();
-    for (; it != data->views.end(); ++it)
-        (*it)->EmbedChanged(false);
-
     data->pixelLock.unlock();
 }
 
@@ -1793,6 +1816,33 @@ void VideoOutputQuartz::ProcessFrame(Vid
         frame->width, frame->height);
 }
 
+/// Subclassed so we can hide the QuickTime drawn layer and show the GUI
+void VideoOutputQuartz::ResizeForGui(void)
+{
+    data->pixelLock.lock();
+    vector<VideoOutputQuartzView*>::iterator it = data->views.begin();
+    for (; it != data->views.end(); ++it)
+        (*it)->HideForGUI();
+    data->pixelLock.unlock();
+
+    VideoOutput::ResizeForGui();
+}
+
+/// Subclassed so we can redisplay the QuickTime layer after ResizeForGui()
+void VideoOutputQuartz::ResizeForVideo(uint width, uint height)
+{
+    VideoOutput::ResizeForVideo(width, height);
+
+    // Base class gives us the correct dimensions for main window/screen:
+    QRect size = windows[0].GetDisplayVideoRect();
+
+    data->pixelLock.lock();
+    vector<VideoOutputQuartzView*>::iterator it = data->views.begin();
+    for (; it != data->views.end(); ++it)
+        (*it)->ShowAfterGUI(size);
+    data->pixelLock.unlock();
+}
+
 QStringList VideoOutputQuartz::GetAllowedRenderers(
     MythCodecID myth_codec_id, const QSize &video_dim)
 {
diff -Naurp mythtv-0.23-release/libs/libmythtv/videoout_quartz.h mythtv-0.23/libs/libmythtv/videoout_quartz.h
--- mythtv-0.23-release/libs/libmythtv/videoout_quartz.h	2010-02-03 10:39:11.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/videoout_quartz.h	2010-07-08 05:12:55.950440000 -0400
@@ -24,6 +24,7 @@ class VideoOutputQuartz : public VideoOu
     void Show(FrameScanType);
 
     void SetVideoFrameRate(float playback_fps);
+    void ToggleAspectOverride(AspectOverrideMode aspectMode);
     bool InputChanged(const QSize &input_size,
                       float        aspect,
                       MythCodecID  av_codec_id,
@@ -34,7 +35,7 @@ class VideoOutputQuartz : public VideoOu
     void Zoom(ZoomDirection direction);
     void ToggleAdjustFill(AdjustFillMode adjustFill);
 
-    void EmbedInWidget(WId wid, int x, int y, int w, int h);
+    void EmbedInWidget(int x, int y, int w, int h);
     void StopEmbedding(void);
 
     DisplayInfo GetDisplayInfo(void);
@@ -45,6 +46,9 @@ class VideoOutputQuartz : public VideoOu
 
     void SetDVDVDecoder(DVDV *dvdvdec);
 
+    void ResizeForGui(void);
+    void ResizeForVideo(uint width = 0, uint height = 0);
+
     static QStringList GetAllowedRenderers(MythCodecID myth_codec_id,
                                            const QSize &video_dim);
 
diff -Naurp mythtv-0.23-release/libs/libmythtv/yuv2rgb.cpp mythtv-0.23/libs/libmythtv/yuv2rgb.cpp
--- mythtv-0.23-release/libs/libmythtv/yuv2rgb.cpp	2010-03-06 22:11:52.000000000 -0500
+++ mythtv-0.23/libs/libmythtv/yuv2rgb.cpp	2010-06-28 03:29:58.793477000 -0400
@@ -417,7 +417,7 @@ static void yuv420_argb32_non_mmx(unsign
     int dstwidth;
 
 // byte indices
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
 #define R_OI  1
 #define G_OI  2
 #define B_OI  3
@@ -490,7 +490,7 @@ void rgb32_to_yuv420p(unsigned char *lum
     unsigned char *p;
 
 // byte indices
-#ifdef WORDS_BIGENDIAN
+#if HAVE_BIGENDIAN
 #define R_II  3
 #define G_II  2
 #define B_II  1
diff -Naurp mythtv-0.23-release/libs/libmythui/mythfontmanager.cpp mythtv-0.23/libs/libmythui/mythfontmanager.cpp
--- mythtv-0.23-release/libs/libmythui/mythfontmanager.cpp	2010-02-24 02:41:32.000000000 -0500
+++ mythtv-0.23/libs/libmythui/mythfontmanager.cpp	2010-06-08 18:21:22.370095000 -0400
@@ -23,7 +23,7 @@ static MythFontManager *gFontManager = N
 void MythFontManager::LoadFonts(const QString &directory,
                                 const QString &registeredFor)
 {
-    if (directory.isEmpty() || registeredFor.isEmpty())
+    if (directory.isEmpty() || directory == "/" || registeredFor.isEmpty())
         return;
 
     // Load the font files from this directory
@@ -100,7 +100,7 @@ void MythFontManager::ReleaseFonts(const
 void MythFontManager::LoadFontsFromDirectory(const QString &directory,
                                              const QString &registeredFor)
 {
-    if (directory.isEmpty() || registeredFor.isEmpty())
+    if (directory.isEmpty() || directory == "/" || registeredFor.isEmpty())
         return;
 
     VERBOSE(VB_FILE + VB_EXTRA, QString("Scanning directory '%1' "
@@ -124,7 +124,7 @@ void MythFontManager::LoadFontsFromDirec
 void MythFontManager::LoadFontFile(const QString &fontPath,
                                    const QString &registeredFor)
 {
-    if (fontPath.isEmpty() || registeredFor.isEmpty())
+    if (fontPath.isEmpty() || fontPath == "/" || registeredFor.isEmpty())
         return;
 
     QMutexLocker locker(&m_lock);
diff -Naurp mythtv-0.23-release/libs/libmythui/mythmainwindow.cpp mythtv-0.23/libs/libmythui/mythmainwindow.cpp
--- mythtv-0.23-release/libs/libmythui/mythmainwindow.cpp	2010-04-29 20:59:58.000000000 -0400
+++ mythtv-0.23/libs/libmythui/mythmainwindow.cpp	2010-05-13 14:40:15.407856000 -0400
@@ -888,12 +888,6 @@ void MythMainWindow::Init(void)
         flags |= Qt::FramelessWindowHint;
     }
 
-    if (d->does_fill_screen && !GetMythUI()->IsGeometryOverridden())
-    {
-        VERBOSE(VB_GENERAL, "Using Full Screen Window");
-        setWindowState(Qt::WindowFullScreen);
-    }
-
     // Workarounds for Qt/Mac bugs
 #ifdef Q_WS_MACX
     if (d->does_fill_screen)
@@ -908,6 +902,12 @@ void MythMainWindow::Init(void)
 
     setWindowFlags(flags);
 
+    if (d->does_fill_screen && !GetMythUI()->IsGeometryOverridden())
+    {
+        VERBOSE(VB_GENERAL, "Using Full Screen Window");
+        setWindowState(Qt::WindowFullScreen);
+    }
+
     d->screenRect = QRect(d->xbase, d->ybase, d->screenwidth, d->screenheight);
     d->uiScreenRect = QRect(0, 0, d->screenwidth, d->screenheight);
 
diff -Naurp mythtv-0.23-release/libs/libmythui/mythsystem.cpp mythtv-0.23/libs/libmythui/mythsystem.cpp
--- mythtv-0.23-release/libs/libmythui/mythsystem.cpp	2010-04-29 20:59:58.000000000 -0400
+++ mythtv-0.23/libs/libmythui/mythsystem.cpp	2010-05-13 14:41:34.441878000 -0400
@@ -189,7 +189,7 @@ uint myth_system(const QString &command,
     {
         VERBOSE(VB_IMPORTANT, (LOC_ERR + "CreateProcess() failed because %1")
                 .arg(::GetLastError()));
-        return MYTHSYSTEM__EXIT__EXECL_ERROR;
+        result = MYTHSYSTEM__EXIT__EXECL_ERROR;
     }
     else
     {
@@ -204,7 +204,7 @@ uint myth_system(const QString &command,
                     .arg(::GetLastError()));
         CloseHandle(pi.hProcess);
         CloseHandle(pi.hThread);
-        return exitcode;
+        result = exitcode;
     }
 #endif
 
diff -Naurp mythtv-0.23-release/libs/libmythui/mythuitext.cpp mythtv-0.23/libs/libmythui/mythuitext.cpp
--- mythtv-0.23-release/libs/libmythui/mythuitext.cpp	2010-03-28 16:39:26.000000000 -0400
+++ mythtv-0.23/libs/libmythui/mythuitext.cpp	2010-06-20 13:40:58.513407000 -0400
@@ -347,13 +347,14 @@ void MythUIText::FillCutMessage()
         if (isNumber && m_TemplateText.contains("%n"))
         {
             m_CutMessage = qApp->translate("ThemeUI",
-                                        qPrintable(m_TemplateText), "",
-                                        QCoreApplication::CodecForTr,
-                                        qAbs(value));
+                                           m_TemplateText.toUtf8(), NULL,
+                                           QCoreApplication::UnicodeUTF8,
+                                           qAbs(value));
         }
         else if (m_TemplateText.contains("%1"))
         {
-            QString tmp = qApp->translate("ThemeUI", qPrintable(m_TemplateText));
+            QString tmp = qApp->translate("ThemeUI", m_TemplateText.toUtf8(),
+                                          NULL, QCoreApplication::UnicodeUTF8);
             m_CutMessage = tmp.arg(m_Message);
         }
     }
@@ -577,7 +578,8 @@ bool MythUIText::ParseElement(
         if (element.attribute("lang","").isEmpty())
         {
             m_Message = qApp->translate("ThemeUI",
-                                        qPrintable(getFirstText(element)));
+                                        getFirstText(element).toUtf8(), NULL,
+                                        QCoreApplication::UnicodeUTF8);
         }
         else if (element.attribute("lang","").toLower() ==
                  GetMythUI()->GetLanguageAndVariant())
diff -Naurp mythtv-0.23-release/libs/libmythui/util-nvctrl.cpp mythtv-0.23/libs/libmythui/util-nvctrl.cpp
--- mythtv-0.23-release/libs/libmythui/util-nvctrl.cpp	2010-03-28 13:16:06.000000000 -0400
+++ mythtv-0.23/libs/libmythui/util-nvctrl.cpp	2010-06-28 04:34:55.227588000 -0400
@@ -107,9 +107,15 @@ int GetNvidiaRates(t_screenrate& screenm
 
     /* first, we query the MetaModes on this X screen */
 
-    XNVCTRLQueryBinaryData(dpy, screen, 0, // n/a
+    ret = XNVCTRLQueryBinaryData(dpy, screen, 0, // n/a
                            NV_CTRL_BINARY_DATA_METAMODES,
                            (unsigned char **)&pMetaModes, &MetaModeLen);
+    if (!ret)
+    {
+        VERBOSE(VB_PLAYBACK, QString("Unknown error. Failed to query the enabled Display Devices."));
+        delete d;
+        return -1;
+    }
 
     /*
      * then, we query the ModeLines for each display device on
@@ -122,9 +128,21 @@ int GetNvidiaRates(t_screenrate& screenm
     {
         if (!(display_devices & mask)) continue;
 
-        XNVCTRLQueryBinaryData(dpy, screen, mask,
+        ret = XNVCTRLQueryBinaryData(dpy, screen, mask,
                                NV_CTRL_BINARY_DATA_MODELINES,
                                (unsigned char **)&str, &len);
+        if (!ret)
+        {
+            VERBOSE(VB_PLAYBACK, QString("Unknown error. Failed to query the enabled Display Devices."));
+            // Free Memory currently allocated
+            for (j=0; j < nDisplayDevice; ++j)
+            {
+                free(pModeLines[j]);
+            }
+            delete d;
+            return -1;
+        }
+		
         pModeLines[nDisplayDevice] = str;
         ModeLineLen[nDisplayDevice] = len;
 
@@ -329,6 +347,8 @@ static void parse_mode_string(char *mode
      * find the modename; stop at the last ' @' (would be easier with regex)
      */
 
+    s_end = strchr(modeString, '\0');
+
     for (char *s = modeString; *s; s++)
     {
         if (*s == ' ' && *(s+1) == '@')
diff -Naurp mythtv-0.23-release/libs/libmythui/xmlparsebase.cpp mythtv-0.23/libs/libmythui/xmlparsebase.cpp
--- mythtv-0.23-release/libs/libmythui/xmlparsebase.cpp	2010-03-02 12:36:30.000000000 -0500
+++ mythtv-0.23/libs/libmythui/xmlparsebase.cpp	2010-05-15 09:04:12.458568000 -0400
@@ -219,7 +219,7 @@ void XMLParseBase::ParseChildren(const Q
             if (parent->ParseElement(filename, info, showWarnings))
             {
             }
-            else if (type == "font")
+            else if (type == "font" || type == "fontdef")
             {
                 bool global = (GetGlobalObjectStore() == parent);
                 MythFontProperties *font = MythFontProperties::ParseFromXml(
@@ -405,7 +405,7 @@ MythUIType *XMLParseBase::ParseUIType(
             if (uitype->ParseElement(filename, info, showWarnings))
             {
             }
-            else if (info.tagName() == "font")
+            else if (info.tagName() == "font" || info.tagName() == "fontdef")
             {
                 bool global = (GetGlobalObjectStore() == parent);
                 MythFontProperties *font = MythFontProperties::ParseFromXml(
@@ -590,7 +590,7 @@ bool XMLParseBase::doLoad(const QString 
             if (!onlywindows)
             {
                 QString type = e.tagName();
-                if (type == "font")
+                if (type == "font" || type == "fontdef")
                 {
                     bool global = (GetGlobalObjectStore() == parent);
                     MythFontProperties *font = MythFontProperties::ParseFromXml(
diff -Naurp mythtv-0.23-release/libs/libswscale/libswscale.pro mythtv-0.23/libs/libswscale/libswscale.pro
--- mythtv-0.23-release/libs/libswscale/libswscale.pro	2010-02-10 17:58:08.000000000 -0500
+++ mythtv-0.23/libs/libswscale/libswscale.pro	2010-05-13 17:57:24.166134000 -0400
@@ -10,9 +10,13 @@ INSTALLS = target
 QMAKE_LFLAGS += $$LDFLAGS
 
 debug:contains(ARCH_X86_32, yes) {
-        QMAKE_CFLAGS_SHLIB =
         QMAKE_CFLAGS_DEBUG += -fomit-frame-pointer
 }
+# gcc-4.2 and newer can not compile with PIC on x86
+contains(ARCH_X86_32, yes) {
+        QMAKE_CFLAGS_SHLIB =
+}
+
 
 !profile:QMAKE_CFLAGS_DEBUG += -O
 
diff -Naurp mythtv-0.23-release/programs/mythbackend/filetransfer.cpp mythtv-0.23/programs/mythbackend/filetransfer.cpp
--- mythtv-0.23-release/programs/mythbackend/filetransfer.cpp	2010-03-10 10:37:33.000000000 -0500
+++ mythtv-0.23/programs/mythbackend/filetransfer.cpp	2010-06-17 09:23:59.559532000 -0400
@@ -41,6 +41,9 @@ FileTransfer::FileTransfer(QString &file
         pginfo->pathname = pginfo->GetPlaybackURL();
         pginfo->MarkAsInUse(true, kFileTransferInUseID);
     }
+
+    if (write)
+        remote->useReadyReadCallback(false);
 }
 
 FileTransfer::~FileTransfer()
diff -Naurp mythtv-0.23-release/programs/mythbackend/main.cpp mythtv-0.23/programs/mythbackend/main.cpp
--- mythtv-0.23-release/programs/mythbackend/main.cpp	2010-04-09 07:29:00.000000000 -0400
+++ mythtv-0.23/programs/mythbackend/main.cpp	2010-05-13 14:45:33.347492000 -0400
@@ -6,8 +6,10 @@
 #include <fcntl.h>
 #include <libgen.h>
 #include <signal.h>
+#ifndef _WIN32
 #include <pwd.h>
 #include <grp.h>
+#endif
 
 #include "mythconfig.h"
 #if CONFIG_DARWIN
@@ -870,6 +872,10 @@ int main(int argc, char **argv)
 
     if (!username.isEmpty())
     {
+#ifdef _WIN32
+        VERBOSE(VB_IMPORTANT, "--user option is not supported on Windows");
+        return BACKEND_EXIT_INVALID_CMDLINE;
+#else // ! _WIN32
         struct passwd *user_info = getpwnam(username.toLocal8Bit().constData());
         const uid_t user_id = geteuid();
 
@@ -914,6 +920,7 @@ int main(int argc, char **argv)
                     .arg(username));
             return BACKEND_EXIT_PERMISSIONS_ERROR;
         }
+#endif // ! _WIN32
     }
 
     if (pidfs)
diff -Naurp mythtv-0.23-release/programs/mythbackend/mainserver.cpp mythtv-0.23/programs/mythbackend/mainserver.cpp
--- mythtv-0.23-release/programs/mythbackend/mainserver.cpp	2010-04-10 17:19:56.000000000 -0400
+++ mythtv-0.23/programs/mythbackend/mainserver.cpp	2010-07-16 22:09:27.287638000 -0400
@@ -427,10 +427,11 @@ void MainServer::ProcessRequestWork(Myth
     }
     else if (command == "DELETE_RECORDING")
     {
-        if (3 <= tokens.size() && tokens.size() <= 4)
+        if (3 <= tokens.size() && tokens.size() <= 5)
         {
             bool force = (tokens.size() >= 4) && (tokens[3] == "FORCE");
-            HandleDeleteRecording(tokens[1], tokens[2], pbs, force);
+            bool forget = (tokens.size() >= 5) && (tokens[4] == "FORGET");
+            HandleDeleteRecording(tokens[1], tokens[2], pbs, force, forget);
         }
         else
             HandleDeleteRecording(listline, pbs, false);
@@ -749,7 +750,7 @@ void MainServer::customEvent(QEvent *e)
                 {
                     recInfo.ForgetHistory();
                 }
-                DoHandleDeleteRecording(recInfo, NULL, false, true);
+                DoHandleDeleteRecording(recInfo, NULL, false, true, false);
             }
             else
             {
@@ -797,9 +798,9 @@ void MainServer::customEvent(QEvent *e)
                 RecordingInfo recInfo(*pinfo);
                 delete pinfo;
                 if (tokens[0] == "FORCE_DELETE_RECORDING")
-                    DoHandleDeleteRecording(recInfo, NULL, true);
+                    DoHandleDeleteRecording(recInfo, NULL, true, false, false);
                 else
-                    DoHandleDeleteRecording(recInfo, NULL, false);
+                    DoHandleDeleteRecording(recInfo, NULL, false, false, false);
             }
             else
             {
@@ -1270,15 +1271,10 @@ void MainServer::HandleAnnounce(QStringL
         else
             filename = LocalFilePath(qurl, wantgroup);
 
-        if (writemode)
-        {
-            socket->setCallbacks(NULL);
-            ft = new FileTransfer(filename, socket, true);
-        }
-        else if (retries >= 0)
-            ft = new FileTransfer(filename, socket, usereadahead, retries);
+        if (retries < 0)
+            ft = new FileTransfer(filename, socket, writemode);
         else
-            ft = new FileTransfer(filename, socket, false);
+            ft = new FileTransfer(filename, socket, usereadahead, retries);
 
         sockListLock.lockForWrite();
         fileTransferList.push_back(ft);
@@ -2131,7 +2127,8 @@ void MainServer::DoHandleStopRecording(
 
 void MainServer::HandleDeleteRecording(QString &chanid, QString &starttime,
                                        PlaybackSock *pbs,
-                                       bool forceMetadataDelete)
+                                       bool forceMetadataDelete, 
+                                       bool forgetHistory)
 {
     ProgramInfo *pginfo =
         ProgramInfo::GetProgramFromRecorded(chanid, starttime);
@@ -2151,7 +2148,7 @@ void MainServer::HandleDeleteRecording(Q
     RecordingInfo ri(*pginfo);
     delete pginfo;
 
-    DoHandleDeleteRecording(ri, pbs, forceMetadataDelete);
+    DoHandleDeleteRecording(ri, pbs, forceMetadataDelete, false, forgetHistory);
 }
 
 void MainServer::HandleDeleteRecording(QStringList &slist, PlaybackSock *pbs,
@@ -2159,12 +2156,12 @@ void MainServer::HandleDeleteRecording(Q
 {
     RecordingInfo recinfo;
     if (recinfo.FromStringList(slist, 1))
-        DoHandleDeleteRecording(recinfo, pbs, forceMetadataDelete);
+        DoHandleDeleteRecording(recinfo, pbs, forceMetadataDelete, false, false);
 }
 
 void MainServer::DoHandleDeleteRecording(
     RecordingInfo &recinfo, PlaybackSock *pbs,
-    bool forceMetadataDelete, bool expirer)
+    bool forceMetadataDelete, bool expirer, bool forgetHistory)
 {
     int resultCode = -1;
     MythSocket *pbssock = NULL;
@@ -2226,6 +2223,9 @@ void MainServer::DoHandleDeleteRecording
                     m_sched->UpdateRecStatus(&recinfo);
             }
 
+            if (forgetHistory)
+                recinfo.ForgetHistory();
+
             if (pbssock)
             {
                 QStringList outputlist( QString::number(num) );
@@ -2266,6 +2266,9 @@ void MainServer::DoHandleDeleteRecording
         }
     }
 
+    if (forgetHistory)
+        recinfo.ForgetHistory();
+
     QFile checkFile(filename);
     bool fileExists = checkFile.exists();
     if (!fileExists)
diff -Naurp mythtv-0.23-release/programs/mythbackend/mainserver.h mythtv-0.23/programs/mythbackend/mainserver.h
--- mythtv-0.23-release/programs/mythbackend/mainserver.h	2010-02-14 00:36:07.000000000 -0500
+++ mythtv-0.23/programs/mythbackend/mainserver.h	2010-07-16 22:09:27.287638000 -0400
@@ -91,11 +91,13 @@ class MainServer : public QObject, publi
     void HandleStopRecording(QStringList &slist, PlaybackSock *pbs);
     void DoHandleStopRecording(RecordingInfo &recinfo, PlaybackSock *pbs);
     void HandleDeleteRecording(QString &chanid, QString &starttime,
-                               PlaybackSock *pbs, bool forceMetadataDelete);
+                               PlaybackSock *pbs, bool forceMetadataDelete,
+                               bool forgetHistory);
     void HandleDeleteRecording(QStringList &slist, PlaybackSock *pbs,
                                bool forceMetadataDelete);
     void DoHandleDeleteRecording(RecordingInfo &recinfo, PlaybackSock *pbs,
-                                 bool forceMetadataDelete, bool expirer=false);
+                                 bool forceMetadataDelete, bool expirer=false,
+                                 bool forgetHistory=false);
     void HandleUndeleteRecording(QStringList &slist, PlaybackSock *pbs);
     void DoHandleUndeleteRecording(RecordingInfo &recinfo, PlaybackSock *pbs);
     void HandleForgetRecording(QStringList &slist, PlaybackSock *pbs);
diff -Naurp mythtv-0.23-release/programs/mythcommflag/main.cpp mythtv-0.23/programs/mythcommflag/main.cpp
--- mythtv-0.23-release/programs/mythcommflag/main.cpp	2010-02-10 12:02:19.000000000 -0500
+++ mythtv-0.23/programs/mythcommflag/main.cpp	2010-05-13 20:49:59.310980000 -0400
@@ -47,6 +47,34 @@ using namespace std;
 #define LOC_WARN QString("MythCommFlag, Warning: ")
 #define LOC_ERR  QString("MythCommFlag, Error: ")
 
+namespace
+{
+    void cleanup()
+    {
+        delete gContext;
+        gContext = NULL;
+
+    }
+
+    class CleanupGuard
+    {
+      public:
+        typedef void (*CleanupFunc)();
+
+      public:
+        CleanupGuard(CleanupFunc cleanFunction) :
+            m_cleanFunction(cleanFunction) {}
+
+        ~CleanupGuard()
+        {
+            m_cleanFunction();
+        }
+
+      private:
+        CleanupFunc m_cleanFunction;
+    };
+}
+
 bool quiet = false;
 bool force = false;
 
@@ -1196,7 +1224,8 @@ int main(int argc, char *argv[])
         ++argpos;
     }
 
-    gContext = NULL;
+    CleanupGuard callCleanup(cleanup);
+
     gContext = new MythContext(MYTH_BINARY_VERSION);
     if (!gContext->Init(
             false/*use gui*/, NULL/*upnp*/, false/*prompt for backend*/,
@@ -1297,8 +1326,6 @@ int main(int argc, char *argv[])
         int breaksFound = FlagCommercials(
             chanid, starttime, outputfilename, useDB);
 
-        delete gContext;
-
         return breaksFound; // exit(breaksFound);
     }
 
@@ -1512,8 +1539,6 @@ int main(int argc, char *argv[])
         }
     }
 
-    delete gContext;
-
     time_now = time(NULL);
 
     if (!quiet)
diff -Naurp mythtv-0.23-release/programs/mythfrontend/playbackbox.cpp mythtv-0.23/programs/mythfrontend/playbackbox.cpp
--- mythtv-0.23-release/programs/mythfrontend/playbackbox.cpp	2010-05-07 12:37:15.000000000 -0400
+++ mythtv-0.23/programs/mythfrontend/playbackbox.cpp	2010-07-16 22:09:27.287638000 -0400
@@ -295,12 +295,13 @@ static void push_onto_del(QStringList &l
     list.push_back(pginfo.chanid);
     list.push_back(pginfo.recstartts.toString(Qt::ISODate));
     list.push_back(false /* force Delete */);
+    list.push_back(false); /* forget history */
 }
 
 static bool extract_one_del(
     QStringList &list, uint &chanid, QDateTime &recstartts)
 {
-    if (list.size() < 3)
+    if (list.size() < 4)
     {
         list.clear();
         return false;
@@ -312,6 +313,7 @@ static bool extract_one_del(
     list.pop_front();
     list.pop_front();
     list.pop_front();
+    list.pop_front();
 
     if (!chanid || !recstartts.isValid())
         VERBOSE(VB_IMPORTANT, LOC_ERR + "extract_one_del() invalid entry");
@@ -2178,19 +2180,14 @@ void PlaybackBox::RemoveProgram(
 
     delItem->availableStatus = asPendingDelete;
     m_helper.DeleteRecording(
-        delItem->chanid.toUInt(), delItem->recstartts, forceMetadataDelete);
+        delItem->chanid.toUInt(), delItem->recstartts, 
+        forceMetadataDelete, forgetHistory);
 
     // if the item is in the current recording list UI then delete it.
     MythUIButtonListItem *uiItem =
         m_recordingList->GetItemByData(qVariantFromValue(delItem));
     if (uiItem)
         m_recordingList->RemoveItem(uiItem);
-
-    if (forgetHistory)
-    {
-        RecordingInfo recInfo(*delItem);
-        recInfo.ForgetHistory();
-    }
 }
 
 void PlaybackBox::fanartLoad(void)
@@ -2407,7 +2404,7 @@ void PlaybackBox::ShowDeletePopup(Delete
     {
         push_onto_del(m_delList, *delItem);
     }
-    else if (m_delList.size() >= 3)
+    else if (m_delList.size() >= 4)
     {
         delItem = FindProgramInUILists(
             m_delList[0].toUInt(),
@@ -2417,7 +2414,7 @@ void PlaybackBox::ShowDeletePopup(Delete
     if (!delItem)
         return;
 
-    uint other_delete_cnt = (m_delList.size() / 3) - 1;
+    uint other_delete_cnt = (m_delList.size() / 4) - 1;
 
     label += CreateProgramInfoString(*delItem);
 
@@ -3241,11 +3238,7 @@ void PlaybackBox::PlaylistDelete(bool fo
             list.push_back(tmpItem->chanid);
             list.push_back(tmpItem->recstartts.toString(Qt::ISODate));
             list.push_back(forceDeleteStr);
-            if (forgetHistory)
-            {
-                RecordingInfo recInfo(*tmpItem);
-                recInfo.ForgetHistory();
-            }
+            list.push_back(forgetHistory ? "1" : "0");
 
             // if the item is in the current recording list UI then delete it.
             MythUIButtonListItem *uiItem =
@@ -3865,17 +3858,13 @@ void PlaybackBox::customEvent(QEvent *ev
                     continue;
 
                 QString forceDeleteStr = me->ExtraDataList()[i+2];
-                bool    forgetHistory  = me->ExtraDataList()[i+3].toInt();
+                QString forgetHistoryStr  = me->ExtraDataList()[i+3];
 
                 list.push_back(pginfo->chanid);
                 list.push_back(pginfo->recstartts.toString(Qt::ISODate));
                 list.push_back(forceDeleteStr);
+                list.push_back(forgetHistoryStr);
                 pginfo->availableStatus = asPendingDelete;
-                if (forgetHistory)
-                {
-                    RecordingInfo recInfo(*pginfo);
-                    recInfo.ForgetHistory();
-                }
 
                 // if the item is in the current recording list UI
                 // then delete it.
@@ -3893,10 +3882,10 @@ void PlaybackBox::customEvent(QEvent *ev
         }
         else if (message == "DELETE_FAILURES")
         {
-            if (me->ExtraDataList().size() < 3)
+            if (me->ExtraDataList().size() < 4)
                 return;
 
-            for (uint i = 0; i+2 < (uint)me->ExtraDataList().size(); i+=3)
+            for (uint i = 0; i+3 < (uint)me->ExtraDataList().size(); i += 4)
             {
                 ProgramInfo *pginfo = m_programInfoCache.GetProgramInfo(
                         me->ExtraDataList()[i+0].toUInt(),
diff -Naurp mythtv-0.23-release/programs/mythfrontend/playbackboxhelper.cpp mythtv-0.23/programs/mythfrontend/playbackboxhelper.cpp
--- mythtv-0.23-release/programs/mythfrontend/playbackboxhelper.cpp	2010-02-25 16:16:03.000000000 -0500
+++ mythtv-0.23/programs/mythfrontend/playbackboxhelper.cpp	2010-07-16 22:09:27.287638000 -0400
@@ -62,18 +62,19 @@ bool PBHEventHandler::event(QEvent *e)
             QStringList successes;
             QStringList failures;
             QStringList list = me->ExtraDataList();
-            while (list.size() >= 3)
+            while (list.size() >= 4)
             {
                 uint      chanid        = list[0].toUInt();
                 QDateTime recstartts    = QDateTime::fromString(
                     list[1], Qt::ISODate);
                 bool      forceDelete   = list[2].toUInt();
+                bool      forgetHistory = list[3].toUInt();
 
                 bool ok = RemoteDeleteRecording(
-                    chanid, recstartts, forceDelete);
+                    chanid, recstartts, forceDelete, forgetHistory);
 
                 QStringList &res = (ok) ? successes : failures;
-                for (uint i = 0; i < 3; i++)
+                for (uint i = 0; i < 4; i++)
                 {
                     res.push_back(list.front());
                     list.pop_front();
@@ -273,12 +274,14 @@ void PlaybackBoxHelper::StopRecording(co
 }
 
 void PlaybackBoxHelper::DeleteRecording(
-    uint chanid, const QDateTime &recstartts, bool forceDelete)
+    uint chanid, const QDateTime &recstartts, bool forceDelete, 
+    bool forgetHistory)
 {
     QStringList list;
     list.push_back(QString::number(chanid));
     list.push_back(recstartts.toString(Qt::ISODate));
     list.push_back((forceDelete)    ? "1" : "0");
+    list.push_back((forgetHistory)  ? "1" : "0");
     DeleteRecordings(list);
 }
 
diff -Naurp mythtv-0.23-release/programs/mythfrontend/playbackboxhelper.h mythtv-0.23/programs/mythfrontend/playbackboxhelper.h
--- mythtv-0.23-release/programs/mythfrontend/playbackboxhelper.h	2010-02-10 10:31:15.000000000 -0500
+++ mythtv-0.23/programs/mythfrontend/playbackboxhelper.h	2010-07-16 22:09:27.287638000 -0400
@@ -55,7 +55,8 @@ class PlaybackBoxHelper : public QThread
     void ForceFreeSpaceUpdate(void);
     void StopRecording(const ProgramInfo&);
     void DeleteRecording(
-        uint chanid, const QDateTime &recstartts, bool forceDelete);
+        uint chanid, const QDateTime &recstartts, 
+        bool forceDelete, bool forgetHistory);
     void DeleteRecordings(const QStringList&);
     void UndeleteRecording(uint chanid, const QDateTime &recstartts);
     void CheckAvailability(const ProgramInfo&,
diff -Naurp mythtv-0.23-release/programs/mythfrontend/statusbox.cpp mythtv-0.23/programs/mythfrontend/statusbox.cpp
--- mythtv-0.23-release/programs/mythfrontend/statusbox.cpp	2010-01-19 20:34:48.000000000 -0500
+++ mythtv-0.23/programs/mythfrontend/statusbox.cpp	2010-07-16 22:09:27.287638000 -0400
@@ -442,7 +442,7 @@ void StatusBox::customEvent(QEvent *even
             if ((buttonnum == 0) && REC_CAN_BE_DELETED(rec))
             {
                 RemoteDeleteRecording(
-                    rec->chanid.toUInt(), rec->recstartts, false);
+                    rec->chanid.toUInt(), rec->recstartts, false, false);
             }
             else if (buttonnum == 1)
             {
diff -Naurp mythtv-0.23-release/programs/mythtranscode/transcode.cpp mythtv-0.23/programs/mythtranscode/transcode.cpp
--- mythtv-0.23-release/programs/mythtranscode/transcode.cpp	2010-04-03 13:16:58.000000000 -0400
+++ mythtv-0.23/programs/mythtranscode/transcode.cpp	2010-06-18 06:50:18.720005000 -0400
@@ -217,6 +217,11 @@ class AudioReencodeBuffer : public Audio
         // Do nothing
         return false;
     }
+    virtual bool CanPassthrough(void) const
+    {
+        // Do nothing
+        return false;
+    }
 
     virtual void SetSWVolume(int new_volume, bool save)
     {
diff -Naurp mythtv-0.23-release/programs/mythtv-setup/main.cpp mythtv-0.23/programs/mythtv-setup/main.cpp
--- mythtv-0.23-release/programs/mythtv-setup/main.cpp	2010-03-11 22:54:16.000000000 -0500
+++ mythtv-0.23/programs/mythtv-setup/main.cpp	2010-05-12 11:25:27.228749000 -0400
@@ -511,7 +511,7 @@ int main(int argc, char *argv[])
             firstBreak+1, secondBreak-firstBreak-1).toLower();
         QString tbl      = scanTableName.mid(secondBreak+1).toLower();
         uint    inputid  = CardUtil::GetInputID(scanCardId, scanInputName);
-        uint    sourceid = ChannelUtil::GetSourceID(inputid);
+        uint    sourceid = CardUtil::GetSourceID(inputid);
         QMap<QString,QString> startChan;
         {
             ChannelScannerCLI scanner(doScanSaveOnly, scanInteractive);
diff -Naurp mythtv-0.23-release/settings.pro mythtv-0.23/settings.pro
--- mythtv-0.23-release/settings.pro	2010-03-26 09:36:07.000000000 -0400
+++ mythtv-0.23/settings.pro	2010-05-11 10:29:50.223949000 -0400
@@ -123,7 +123,7 @@ ALSA_LIBS = $$CONFIG_AUDIO_ALSA_LIBS
 JACK_LIBS = $$CONFIG_AUDIO_JACK_LIBS
 PULSE_LIBS = $$CONFIG_AUDIO_PULSE_LIBS
 
-EXTRA_LIBS = $$FREETYPE_LIBS
+EXTRA_LIBS += $$FREETYPE_LIBS
 EXTRA_LIBS += $$CONFIG_FIREWIRE_LIBS
 EXTRA_LIBS += $$CONFIG_DIRECTFB_LIBS
 
diff -Naurp mythtv-0.23-release/themes/MythCenter/base.xml mythtv-0.23/themes/MythCenter/base.xml
--- mythtv-0.23-release/themes/MythCenter/base.xml	2010-05-09 10:40:52.000000000 -0400
+++ mythtv-0.23/themes/MythCenter/base.xml	2010-06-28 03:09:44.900378000 -0400
@@ -8,6 +8,10 @@
         <bold>yes</bold>
     </font>
   
+    <font name="basesmaller" from="basesmall">
+        <pixelsize>18</pixelsize>
+    </font>
+  
     <font name="basesmallbold" from="basesmall">
         <bold>yes</bold>
     </font>
diff -Naurp mythtv-0.23-release/themes/MythCenter-wide/base.xml mythtv-0.23/themes/MythCenter-wide/base.xml
--- mythtv-0.23-release/themes/MythCenter-wide/base.xml	2010-04-03 12:52:26.000000000 -0400
+++ mythtv-0.23/themes/MythCenter-wide/base.xml	2010-06-28 03:09:44.900378000 -0400
@@ -8,6 +8,10 @@
         <bold>yes</bold>
     </font>
   
+    <font name="basesmaller" from="basesmall">
+        <pixelsize>18</pixelsize>
+    </font>
+  
     <font name="basesmallbold" from="basesmall">
         <bold>yes</bold>
     </font>
diff -Naurp mythtv-0.23-release/VERSION mythtv-0.23/VERSION
--- mythtv-0.23-release/VERSION	2010-05-09 20:07:58.000000000 -0400
+++ mythtv-0.23/VERSION	1969-12-31 19:00:00.000000000 -0500
@@ -1 +0,0 @@
-SOURCE_VERSION="0.23"
diff -Naurp mythtv-0.23-release/version.pro mythtv-0.23/version.pro
--- mythtv-0.23-release/version.pro	2009-10-04 12:38:03.000000000 -0400
+++ mythtv-0.23/version.pro	2009-10-04 12:38:03.692900000 -0400
@@ -6,7 +6,7 @@
 ############################################################
 
 SVNTREEDIR = $$system(pwd)
-SVNREPOPATH = "$$URL: http://svn.mythtv.org/svn/tags/release-0-23/mythtv/version.pro $$"
+SVNREPOPATH = "$$URL: svn+ssh://svn.mythtv.org/var/lib/svn/branches/release-0-23-fixes/mythtv/version.pro $$"
 
 
 SOURCES += version.cpp
